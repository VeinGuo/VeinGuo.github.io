<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Vein</title>
  <subtitle>å¹´è½»äººï¼Œæ²‰ä½æ°”ã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://github.com/VeinGuo/"/>
  <updated>2017-06-21T01:23:59.000Z</updated>
  <id>https://github.com/VeinGuo/</id>
  
  <author>
    <name>Vein</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="https://github.com/VeinGuo/2017/06/20/2017-6-15-iOS-Swift%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8VGPlayer/"/>
    <id>https://github.com/VeinGuo/2017/06/20/2017-6-15-iOS-Swiftå°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨VGPlayer/</id>
    <published>2017-06-20T07:56:54.000Z</published>
    <updated>2017-06-21T01:23:59.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Swift-å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨-VGPlayer"><a href="#Swift-å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨-VGPlayer" class="headerlink" title="Swift å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ VGPlayer"></a>Swift å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ VGPlayer</h1><p><img src="http://upload-images.jianshu.io/upload_images/3672149-555ba04e6c5a5e30.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Banners.png"></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="# å‰è¨€"></a># å‰è¨€</h2><p>ä¹‹å‰å­¦ä¹ äº† Swift ä¸€ç›´æƒ³åšä¸€ä¸ªé¡¹ç›®ï¼Œè¿™æ¬¡ä¸‹å®šå†³å¿ƒèŠ±äº†è¿‘1ä¸ªæœˆçš„ç©ºé—²æ—¶é—´åŸºäº AVPlayer å°è£…äº†ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ã€‚</p>
<h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="# æºä»£ç "></a># æºä»£ç </h2><ul>
<li>GitHubåœ°å€ï¼š<a href="https://github.com/VeinGuo/VGPlayer">VGPlayer</a></li>
<li>æœ‰ä»€ä¹ˆæ„è§å»ºè®®å¯ä»¥æ issues,åœ¨åšæ–‡ä¸‹ç•™è¨€ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ç‚¹starã€‚</li>
</ul>
<h2 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="# æ¼”ç¤º"></a># æ¼”ç¤º</h2><p><img src="http://upload-images.jianshu.io/upload_images/3672149-8d4002b808f1637d.gif?imageMogr2/auto-orient/strip" alt="demo1.gif"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3672149-d7eb8ea47b03b5e4.gif?imageMogr2/auto-orient/strip" alt="demo2.gif"></p>
<a id="more"></a>
<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="# åŠŸèƒ½"></a># åŠŸèƒ½</h2><ul>
<li>é›†æˆäº†è§†é¢‘æ’­æ”¾å™¨å¸¸æœ‰çš„æ‰‹åŠ¿ï¼ŒåŒ…æ‹¬å•å‡»æ˜¾ç¤ºæ§åˆ¶è§†å›¾ï¼ŒåŒå‡»æš‚åœï¼Œæ°´å¹³æ»‘åŠ¨å¿«è¿›ã€åé€€ï¼Œç«–ç›´æ»‘åŠ¨äº®åº¦å’ŒéŸ³é‡è°ƒèŠ‚ã€‚</li>
<li>å…¨å±æ’­æ”¾ï¼Œè‡ªé€‚åº”æ‰‹æœºå±å¹•æ—‹è½¬æ–¹å‘ã€‚</li>
<li>è‡ªå®šä¹‰æ§åˆ¶è§†å›¾</li>
</ul>
<h2 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="# å®ç°æ€è·¯"></a># å®ç°æ€è·¯</h2><p><img src="http://upload-images.jianshu.io/upload_images/3672149-97c3599a629ed811.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æµç¨‹å›¾.png"></p>
<h4 id="VGPlayer"><a href="#VGPlayer" class="headerlink" title="VGPlayer"></a>VGPlayer</h4><p>VGPlayeræ˜¯ä¸€ä¸ªå¯¹AVPlayerå°è£…æä¾›æ’­æ”¾åŠŸèƒ½ï¼ŒdisplayViewä¸ºæ’­æ”¾å™¨ç”»é¢ç»˜åˆ¶ã€‚<br>ä¸»è¦æ˜¯ä½¿ç”¨äº†ä»¥ä¸‹å‡ ä¸ªç±»ï¼š</p>
<ul>
<li>AVURLAssetæ˜¯ AVAssetçš„å­ç±»ï¼Œç”¨æ¥æœ¬åœ°æˆ–è€…ç½‘ç»œè§†é¢‘åœ°å€çš„åˆå§‹åŒ–ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è·å–è§†é¢‘æ¯ä¸€å¸§çš„ç”»é¢æ¥å®ç°æ»‘åŠ¨æå‰é¢„è§ˆå›¾çš„åŠŸèƒ½ï¼ˆåç»­åº”è¯¥ä¼šç‰ˆæœ¬è¿­ä»£åŠ ä¸Šæ­¤åŠŸèƒ½ï¼‰</li>
<li>AVPlayerItem æ˜¯å¯¹AVPlayeræ’­æ”¾çš„è§†é¢‘æ•°æ®ç®¡ç†ï¼Œå¯¹æ’­æ”¾çš„Assetèµ„æºè¿›è¡Œè®°å½•ï¼Œæä¾›æˆ–è€…è§†é¢‘çš„æ—¶é—´ï¼Œæ’­æ”¾çŠ¶æ€ç­‰ã€‚</li>
<li>AVPlayer è°ƒæ§æ•°æ®å’Œè§†å›¾</li>
<li>AVPlayerLayer è¿›è¡Œè§†é¢‘è§†å›¾ç»˜åˆ¶</li>
</ul>
<p>VGPlayerå°è£…AVPlayeræä¾›ç»™è°ƒç”¨è€…å¯é€‰ä»£ç†æ–¹æ³•</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// player delegate</span></div><div class="line">Â  Â  <span class="comment">// play state</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayer</span><span class="params">(<span class="number">_</span> player: VGPlayer, stateDidChange state: VGPlayerState)</span></span></div><div class="line">Â  Â  <span class="comment">// playe Duration</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayer</span><span class="params">(<span class="number">_</span> player: VGPlayer, playerDurationDidChange currentDuration: TimeInterval, totalDuration: TimeInterval)</span></span></div><div class="line">Â  Â  <span class="comment">// buffer state</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayer</span><span class="params">(<span class="number">_</span> player: VGPlayer, bufferStateDidChange state: VGPlayerBufferstate)</span></span></div><div class="line">Â  Â  <span class="comment">// buffered Duration</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayer</span><span class="params">(<span class="number">_</span> player: VGPlayer, bufferedDidChange bufferedDuration: TimeInterval, totalDuration: TimeInterval)</span></span></div><div class="line">Â  Â  <span class="comment">// play error</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayer</span><span class="params">(<span class="number">_</span> player: VGPlayer, playerFailed error: VGPlayerError)</span></span></div></pre></td></tr></table></figure>
<h4 id="VGPlayerView"><a href="#VGPlayerView" class="headerlink" title="VGPlayerView"></a>VGPlayerView</h4><ul>
<li>VGPlayerViewè´Ÿè´£ç”»é¢çš„å±•ç¤º,ï¼Œåªä½œä¸ºå±•ç¤ºï¼Œè€Œç»˜åˆ¶å±‚åˆ™æ˜¯AVPlayerLayeræä¾›ï¼Œå¯ç»§æ‰¿æ­¤ç±»è¿›è¡Œæ§åˆ¶è§†å›¾çš„è‡ªå®šä¹‰</li>
<li>VGPlayerViewå°è£…AVPlayerLayeræä¾›å¯é€‰ä»£ç†æ–¹æ³•</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// player view delegate</span></div><div class="line">Â  Â  <span class="comment">/// fullscreen</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayerView</span><span class="params">(<span class="number">_</span> playerView: VGPlayerView, willFullscreen fullscreen: Bool)</span></span></div><div class="line">Â  Â  <span class="comment">/// close play view</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayerView</span><span class="params">(didTappedClose playerView: VGPlayerView)</span></span></div><div class="line">Â  Â  <span class="comment">/// displaye control</span></div><div class="line">Â  Â  <span class="function"><span class="keyword">func</span> <span class="title">vgPlayerView</span><span class="params">(didDisplayControl playerView: VGPlayerView)</span></span></div></pre></td></tr></table></figure>
<h4 id="VGPlayerError"><a href="#VGPlayerError" class="headerlink" title="VGPlayerError"></a>VGPlayerError</h4><ul>
<li>VGPlayerErrorä¸€ä¸ª struct ç”¨æ¥æ’­æ”¾å‡ºç°Erroræ—¶è¿”å›</li>
</ul>
<h2 id="ç»†èŠ‚è°ƒæ•´"><a href="#ç»†èŠ‚è°ƒæ•´" class="headerlink" title="# ç»†èŠ‚è°ƒæ•´"></a># ç»†èŠ‚è°ƒæ•´</h2><ul>
<li>åå°æ’­æ”¾çš„å®ç°<br>è®¾ç½®å·¥ç¨‹</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/3672149-679c678013de6ce7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="backgroundModes.png"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// AppDelegate settings</span></div><div class="line">Â <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">// Override point for customization after application launch.</span></div><div class="line">Â  Â  Â  Â  <span class="keyword">do</span></div><div class="line">Â  Â  Â  Â  &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">try</span> <span class="type">AVAudioSession</span>.sharedInstance().setCategory(<span class="type">AVAudioSessionCategoryPlayback</span>)</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  Â  Â  <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">NSError</span></div><div class="line">Â  Â  Â  Â  &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">print</span>(error)</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">Â  Â  &#125;</div></pre></td></tr></table></figure>
<p>è®¾ç½®VGPlayerçš„Background mode<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.player.backgroundMode = .proceed</div></pre></td></tr></table></figure></p>
<ul>
<li>VGPlayerUtils æä¾›åˆ¤æ–­è§†é¢‘ç±»å‹æ–¹æ³•å’Œä¸€äº›é€šç”¨çš„æ–¹æ³•</li>
<li>UIButton+VGPlayer æ‰©å±•æŒ‰é’®ç‚¹å‡»èŒƒå›´</li>
<li>Timer+VGPlayer è§£å†³Timerçš„ retain cycleé—®é¢˜</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="# å‚è€ƒ"></a># å‚è€ƒ</h2><ul>
<li><a href="https://techblog.toutiao.com/2017/03/28/fullscreen/" target="_blank" rel="external">https://techblog.toutiao.com/2017/03/28/fullscreen/</a></li>
<li><a href="https://developer.apple.com/library/content/qa/qa1668/_index.html" target="_blank" rel="external">https://developer.apple.com/library/content/qa/qa1668/_index.html</a></li>
<li><a href="https://developer.apple.com/documentation/avfoundation" target="_blank" rel="external">https://developer.apple.com/documentation/avfoundation</a></li>
<li><a href="https://stackoverflow.com/questions/808503/uibutton-making-the-hit-area-larger-than-the-default-hit-area/13977921" target="_blank" rel="external">https://stackoverflow.com/questions/808503/uibutton-making-the-hit-area-larger-than-the-default-hit-area/13977921</a></li>
<li><a href="https://gist.github.com/onevcat/2d1ceff1c657591eebde" target="_blank" rel="external">https://gist.github.com/onevcat/2d1ceff1c657591eebde</a></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="# æ€»ç»“"></a># æ€»ç»“</h2><ul>
<li>äº†è§£äº†AVPlayerçš„æ•´ä½“ç»“æ„ï¼Œå¯¹æ’­æ”¾è¿‡ç¨‹å®Œæ•´çš„æ€è·¯å’Œä¸€äº›é‡åˆ°çš„é—®é¢˜ã€‚</li>
<li>è¸©äº†å±å¹•æ—‹è½¬ç»†èŠ‚ã€æŒ‰é’®ç‚¹å‡»èŒƒå›´è°ƒæ•´çš„ä¸€äº›äº¤äº’ç»†èŠ‚çš„å‘</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Swift-å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨-VGPlayer&quot;&gt;&lt;a href=&quot;#Swift-å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨-VGPlayer&quot; class=&quot;headerlink&quot; title=&quot;Swift å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ VGPlayer&quot;&gt;&lt;/a&gt;Swift å°è£…ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ VGPlayer&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/3672149-555ba04e6c5a5e30.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;Banners.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;# å‰è¨€&quot;&gt;&lt;/a&gt;# å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹‹å‰å­¦ä¹ äº† Swift ä¸€ç›´æƒ³åšä¸€ä¸ªé¡¹ç›®ï¼Œè¿™æ¬¡ä¸‹å®šå†³å¿ƒèŠ±äº†è¿‘1ä¸ªæœˆçš„ç©ºé—²æ—¶é—´åŸºäº AVPlayer å°è£…äº†ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æºä»£ç &quot;&gt;&lt;a href=&quot;#æºä»£ç &quot; class=&quot;headerlink&quot; title=&quot;# æºä»£ç &quot;&gt;&lt;/a&gt;# æºä»£ç &lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;GitHubåœ°å€ï¼š&lt;a href=&quot;https://github.com/VeinGuo/VGPlayer&quot;&gt;VGPlayer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æœ‰ä»€ä¹ˆæ„è§å»ºè®®å¯ä»¥æ issues,åœ¨åšæ–‡ä¸‹ç•™è¨€ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ç‚¹starã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ¼”ç¤º&quot;&gt;&lt;a href=&quot;#æ¼”ç¤º&quot; class=&quot;headerlink&quot; title=&quot;# æ¼”ç¤º&quot;&gt;&lt;/a&gt;# æ¼”ç¤º&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/3672149-8d4002b808f1637d.gif?imageMogr2/auto-orient/strip&quot; alt=&quot;demo1.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/3672149-d7eb8ea47b03b5e4.gif?imageMogr2/auto-orient/strip&quot; alt=&quot;demo2.gif&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å®ç°ä¸€ä¸ªiOSæ¸å˜èƒŒæ™¯åŠ¨ç”»æ•ˆæœçš„Switch</title>
    <link href="https://github.com/VeinGuo/2017/02/16/2017-2-16-iOS-Gradient-Switch/"/>
    <id>https://github.com/VeinGuo/2017/02/16/2017-2-16-iOS-Gradient-Switch/</id>
    <published>2017-02-16T00:16:21.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨dribbbleçœ‹åˆ°ä¸€ä¸ªSwitchåŠ¨ç”»æ•ˆæœå°±æ‰‹ç—’æƒ³å®ç°ï¼Œä¸‹é¢å°±æ˜¯æˆ‘å®ç°çš„æ€è·¯ã€‚</p>
<h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h2><p>GitHubåœ°å€ï¼š<a href="https://github.com/VeinGuo/VGGradientSwitch">VGGradientSwitch</a><br>å¦‚æœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ç‚¹starã€‚</p>
<h2 id="è®¾è®¡å›¾"><a href="#è®¾è®¡å›¾" class="headerlink" title="è®¾è®¡å›¾"></a>è®¾è®¡å›¾</h2><p>æ¥è‡ªdribbbleä¸Šçš„è®¾è®¡ä½œè€… <a href="https://dribbble.com/nick_buturishvili" target="_blank" rel="external">Nick Buturishvili</a><br><img src="https://d13yacurqjgara.cloudfront.net/users/408943/screenshots/2272690/switch.gif" alt="image"></p>
<h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><p><img src="http://ojaltanzc.bkt.clouddn.com/switch_button_1.gif" alt="image"><br><a id="more"></a></p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul>
<li>é¦–å…ˆè§£åˆ¨ä¸€ä¸‹è®¾è®¡å›¾</li>
</ul>
<ol>
<li>å¤–è§‚å’ŒiOSåŸç”ŸUISwitchç›¸åŒ</li>
<li>è§‚å¯ŸåŠ¨å›¾å‘ç°SwitchèƒŒæ™¯å›¾ä¸ºæ¸å˜è‰²ï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªå¼€å…³è®¾è®¡çš„ä¸€å¤§äº®ç‚¹</li>
<li>å¼€å…³ä¸Šçš„çº½æ‰£ï¼Œæ‰“å¼€æ—¶çŠ¶æ€æ˜¯ä¸€ä¸ªå‹¾ï¼Œå…³é—­æ—¶æ˜¯ä¸€ä¸ªå‰ã€‚</li>
<li>æ‰“å¼€åŠ¨ç”»ï¼Œå‹¾è¾¹çº¿æ”¾å¤§ç§»åŠ¨è¾¹åšå½¢å˜å˜æˆç‚¹å†å˜æ¢æˆå‰æ”¾å¤§åæ¢å¤åŸçŠ¶ï¼ŒèƒŒæ™¯é¢œè‰²ç”±é’è‰²è½¬æ¢åˆ°æ©˜é»„è‰²ã€‚</li>
<li>å…³é—­åŠ¨ç”»ï¼Œå‰è¾¹å…ˆæ”¾å¤§ç§»åŠ¨è¾¹åšå½¢å˜å†å˜æˆå‹¾æ”¾å¤§åæ¢å¤åŸçŠ¶ï¼ŒèƒŒæ™¯é¢œè‰²ç”±æ©˜é»„è‰²è½¬æ¢åˆ°é’è‰²</li>
</ol>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><ul>
<li>æ¸å˜èƒŒæ™¯å›¾æ˜¯é€šè¿‡<code>CAGradientLayer</code>å®ç°ã€‚é€šè¿‡è®¾è®¡å›¾å–è‰²æ‹¿åˆ°é¢œè‰²åå…­è¿›åˆ¶(0x08ded6,0x18deb9,0xef9c29,0xe76b39)å››ä¸ªé¢œè‰²,åˆ›å»ºå‡ºä¸€ä¸ª3å€çš„switchå®½åº¦æ¸å˜å›¾<br>å¦‚å›¾: <img src="http://upload-images.jianshu.io/upload_images/3672149-30b1f130c7724472.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></li>
</ul>
<p>ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CAGradientLayer *gradientLayer = [CAGradientLayer layer];</div><div class="line">gradientLayer.locations = @[@0, @.33, @.63, @1];</div><div class="line">gradientLayer.startPoint = CGPointMake(0, 0);</div><div class="line">gradientLayer.endPoint = CGPointMake(1, 0);</div><div class="line">gradientLayer.frame = CGRectMake(0, 0, self.frame.size.width * 3, self.frame.size.height);</div></pre></td></tr></table></figure>
<ul>
<li>è¾¹æ¡†ä½¿ç”¨<code>UIBezierPath</code>è®¾ç½®ä¸€ä¸ªåœ†è§’è¾¹æ¡†</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/3672149-16dc2c56abc88cf2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<ul>
<li>å‹¾ã€ç‚¹å’Œå‰çš„å®ç°ä½¿ç”¨åˆ°<code>UIBezierPath</code>æä¾›pathï¼Œç„¶å<code>CAShapeLayer</code>åˆ›å»ºï¼Œå‹¾å›¾å½¢å®ç°ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">UIBezierPath *tickPath = [UIBezierPath bezierPath];</div><div class="line">[tickPath moveToPoint:CGPointMake(self.frame.size.width/8 * 3, self.frame.size.width/2)];</div><div class="line">CGPoint p1 = CGPointMake(self.frame.size.width/2, self.frame.size.width/8 * 5);</div><div class="line">[tickPath addLineToPoint:p1];</div><div class="line">CGPoint p2 = CGPointMake(self.frame.size.width/8 * 6, self.frame.size.width/8 * 3);</div><div class="line">[tickPath addLineToPoint:p2];</div><div class="line"></div><div class="line">CAShapeLayer *layer = [[CAShapeLayer alloc] init];</div><div class="line">layer.lineCap = kCALineCapRound;</div><div class="line">layer.lineJoin = kCALineJoinRound;</div><div class="line">layer.fillColor = [UIColor clearColor].CGColor;</div><div class="line">layer.strokeColor = [UIColor whiteColor].CGColor;</div><div class="line">layer.lineWidth = 2;</div><div class="line">layer.path = tickPath.CGPath;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/3672149-8012e458f4808968.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<ul>
<li>æ¸å˜èƒŒæ™¯é¢œè‰²çš„åŠ¨ç”»æ•ˆæœï¼Œç¬”è€…æ˜¯å°†<code>CAGradientLayer</code>æ·»åŠ åˆ°ä¸€ä¸ªUIViewä¸Šç„¶åç›´æ¥ä½¿ç”¨ï¼ŒUIViewçš„åŠ¨ç”»æ–¹æ³•ç„¶ååšä½ç§»ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[UIView animateKeyframesWithDuration:.5 delay:.1 options:UIViewKeyframeAnimationOptionCalculationModePaced animations:^&#123;</div><div class="line">        self.gradientView.frame = CGRectMake(-self.frame.size.width *2, 0, self.frame.size.width *3, self.frame.size.height);</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">    </div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/3672149-e93f0003fde40f55.gif?imageMogr2/auto-orient/strip" alt="image"></p>
<ul>
<li>å›¾å½¢å½¢å˜åŠ¨ç”»ä¸»è¦åˆ©ç”¨<code>Core Animation</code>å®ç°,ç”¨åˆ°äº†<code>CAKeyframeAnimation</code>ã€<code>CABasicAnimation</code>ã€<code>CAAnimationGroup</code></li>
<li>å‹¾-&gt;ç‚¹åŠ¨ç”»  å…ˆæ”¾å¤§å‹¾åç„¶ååšç¼©å°å½¢å˜æˆç‚¹ </li>
<li>ç‚¹-&gt;å‹¾åŠ¨ç”»  åšå½¢å˜æˆå‹¾ååšæ”¾å¤§</li>
<li><p>åŠ¨ç”»ä½¿ç”¨äº†â€pathâ€å’Œâ€transformâ€ï¼Œå½¢å˜åŠ¨ç”»ä½¿ç”¨pathæä¾›è·¯å¾„æ•°ç»„ï¼Œè¿™é‡Œæä¾›åŸæœ¬å‹¾çš„è·¯å¾„å’Œç‚¹çš„è·¯å¾„è¿™æ ·è·¯å¾„å°±ä»å‹¾å½¢å˜åˆ°ç‚¹<br>ä»£ç å¦‚ä¸‹:</p>
</li>
<li><p>æ”¾å¤§åŠ¨ç”» ä½¿ç”¨<code>CABasicAnimation</code></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;transform&quot;];</div><div class="line">CATransform3D tr = CATransform3DIdentity;</div><div class="line">tr = CATransform3DTranslate(tr, _rect.size.width/2, _rect.size.height/2, 0);</div><div class="line">tr = CATransform3DScale(tr, 1.2, 1.2, 1);</div><div class="line">tr = CATransform3DTranslate(tr, -_rect.size.width/2, -_rect.size.height/2, 0);</div><div class="line">animation.toValue = [NSValue valueWithCATransform3D:tr];</div><div class="line">animation.autoreverses = YES;</div><div class="line">animation.timingFunction  = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];</div></pre></td></tr></table></figure>
<ul>
<li>å½¢å˜åŠ¨ç”» ä½¿ç”¨<code>CAKeyframeAnimation</code>å…·ä½“çš„ä½¿ç”¨å¯ä»¥Googleä¸€ä¸‹è¿™é‡Œå°±ä¸å¤šèµ˜è¨€,<code>values</code>ä¼ å…¥çš„æ˜¯å‹¾çš„pathå’Œç‚¹path</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;path&quot;];</div><div class="line">animation.values = values;</div><div class="line">animation.keyTimes = keyTimes;</div><div class="line">animation.beginTime = beginTime;</div></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨<code>CAAnimationGroup</code>åšç»„åˆåŠ¨ç”»,ç»„åˆåŠ¨ç”»ä»£ç†æ–¹æ³•å¯ä»¥åˆ¤æ–­ç»„åˆåŠ¨ç”»æ˜¯å¦å®Œæˆï¼Œ<code>&lt;CAAnimationDelegate&gt;</code> ä»£ç å¦‚ä¸‹:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// scaleAnimation æ”¾å¤§ lineAnimationçº¿æ¡å½¢å˜</div><div class="line">  CAAnimationGroup *animationGroup = [CAAnimationGroup animation];</div><div class="line">  animationGroup.animations = @[scaleAnimation,lineAnimation];</div><div class="line">  animationGroup.duration = .5;</div><div class="line">  animationGroup.repeatCount = 1;</div><div class="line">  animationGroup.removedOnCompletion = NO;</div><div class="line">  animationGroup.fillMode = kCAFillModeForwards;</div><div class="line">  animationGroup.timingFunction  = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">  animationGroup.delegate = self;</div><div class="line">  </div><div class="line">  // CAAnimationDelegate  åŠ¨ç”»æ˜¯å¦ç»“æŸ</div><div class="line">  - (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/3672149-6989c7df61f3ff5b.gif?imageMogr2/auto-orient/strip" alt="image"></p>
<ul>
<li>å‰©ä¸‹çš„å°±æ˜¯ç§»åŠ¨è¿™ä¸ªæŒ‰é’®ç„¶åç”±ç‚¹å½¢å˜æˆå‰è¿™é‡Œå°±ä¸å†è¯´æ˜ï¼Œå¯ä»¥ç›´æ¥çœ‹GitHubä»£ç ,ä»¥ä¸Šå°±æ˜¯åˆ†è§£åŠ¨ç”»çš„ä¸€äº›æ€è·¯å’Œè§£å†³åŠæ³•ï¼Œä½†æ˜¯åŠ¨ç”»è¦æµç•…å’Œäº¤äº’ä¸è¿å’Œè¿˜éœ€è¦ç»†å¾®è°ƒæ•´</li>
<li>æœ‰ä»€ä¹ˆä»£ç å’Œå®ç°çš„æ•ˆæœå»ºè®®å¯ä»¥æissueç»™æˆ‘ï¼Œå¦‚æœå–œæ¬¢çš„è¯ç‚¹ä¸€ä¸‹ star å“¦</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨dribbbleçœ‹åˆ°ä¸€ä¸ªSwitchåŠ¨ç”»æ•ˆæœå°±æ‰‹ç—’æƒ³å®ç°ï¼Œä¸‹é¢å°±æ˜¯æˆ‘å®ç°çš„æ€è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æºä»£ç &quot;&gt;&lt;a href=&quot;#æºä»£ç &quot; class=&quot;headerlink&quot; title=&quot;æºä»£ç &quot;&gt;&lt;/a&gt;æºä»£ç &lt;/h2&gt;&lt;p&gt;GitHubåœ°å€ï¼š&lt;a href=&quot;https://github.com/VeinGuo/VGGradientSwitch&quot;&gt;VGGradientSwitch&lt;/a&gt;&lt;br&gt;å¦‚æœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ç‚¹starã€‚&lt;/p&gt;
&lt;h2 id=&quot;è®¾è®¡å›¾&quot;&gt;&lt;a href=&quot;#è®¾è®¡å›¾&quot; class=&quot;headerlink&quot; title=&quot;è®¾è®¡å›¾&quot;&gt;&lt;/a&gt;è®¾è®¡å›¾&lt;/h2&gt;&lt;p&gt;æ¥è‡ªdribbbleä¸Šçš„è®¾è®¡ä½œè€… &lt;a href=&quot;https://dribbble.com/nick_buturishvili&quot;&gt;Nick Buturishvili&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;https://d13yacurqjgara.cloudfront.net/users/408943/screenshots/2272690/switch.gif&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ•ˆæœå›¾&quot;&gt;&lt;a href=&quot;#æ•ˆæœå›¾&quot; class=&quot;headerlink&quot; title=&quot;æ•ˆæœå›¾&quot;&gt;&lt;/a&gt;æ•ˆæœå›¾&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://ojaltanzc.bkt.clouddn.com/switch_button_1.gif&quot; alt=&quot;image&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://github.com/VeinGuo/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>iOS Memory management</title>
    <link href="https://github.com/VeinGuo/2016/12/29/iOS-Memory-management/"/>
    <id>https://github.com/VeinGuo/2016/12/29/iOS-Memory-management/</id>
    <published>2016-12-28T21:44:29.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="# å‰è¨€"></a># å‰è¨€</h2><blockquote>
<p>åå¤åœ°å¤ä¹ iOSåŸºç¡€çŸ¥è¯†å’ŒåŸç†ï¼Œæ‰“ç£¨çŸ¥è¯†ä½“ç³»æ˜¯éå¸¸é‡è¦çš„ï¼Œæœ¬ç¯‡å°±æ˜¯é‡æ–°æ¸©ä¹ iOSçš„å†…å­˜ç®¡ç†ã€‚</p>
</blockquote>
<p>å†…å­˜ç®¡ç†æ˜¯ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å¯¹è±¡ä¸éœ€è¦æ—¶è¿›è¡Œå†…å­˜é‡Šæ”¾çš„ç¼–ç¨‹è§„èŒƒã€‚</p>
<h2 id="MRRæ—¶ä»£"><a href="#MRRæ—¶ä»£" class="headerlink" title="# MRRæ—¶ä»£"></a># MRRæ—¶ä»£</h2><h3 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h3><p>Objective-Cå†…å­˜ç®¡ç†ä½¿ç”¨ä½¿ç”¨å¼•ç”¨è®¡æ•°(Reference Counting)æ¥ç®¡ç†å†…å­˜ã€‚</p>
<blockquote>
<p>åœ¨OS X 10.8ä»¥åä¹Ÿä¸å†ä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒiOSåˆ™ä»æ¥éƒ½æ²¡æœ‰æ”¯æŒåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>
</blockquote>
<p>å½“<code>create</code>æˆ–è€…<code>copy</code>å¯¹è±¡æ—¶ï¼Œä¼šè®¡æ•°ä¸º1ï¼Œå…¶ä»–å¯¹è±¡éœ€è¦<code>retain</code>æ—¶ï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚æŒæœ‰å¯¹è±¡çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥æ”¾å¼ƒæ‰€æœ‰æƒï¼Œæ”¾å¼ƒæ‰€æœ‰æƒæ—¶å‡å°‘è®¡æ•°ï¼Œå½“è®¡æ•°ä¸º0æ—¶å°±ä¼šé‡Šæ”¾å¯¹è±¡ã€‚<br>å¦‚å›¾ï¼š</p>
<p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-29-memory-management/memory_management_2x.png" alt="memory_management"><br><a id="more"></a></p>
<h4 id="Memory-Management-Policy-å†…å­˜ç®¡ç†ç­–ç•¥"><a href="#Memory-Management-Policy-å†…å­˜ç®¡ç†ç­–ç•¥" class="headerlink" title="Memory Management Policy å†…å­˜ç®¡ç†ç­–ç•¥"></a>Memory Management Policy å†…å­˜ç®¡ç†ç­–ç•¥</h4><ul>
<li>é€šè¿‡åˆ†é…å†…å­˜æˆ–<code>copy</code>æ¥åˆ›å»ºä»»ä½•å¯¹è±¡</li>
<li>ä½¿ç”¨æ–¹æ³• <code>alloc</code>, <code>allocWithZone:</code>, <code>copy</code>, <code>copyWithZone:</code>, <code>mutableCopy</code> , <code>mutableCopyWithZone:</code>åˆ›å»ºå¯¹è±¡</li>
<li>é€šè¿‡<code>retain</code>æ¥è·å–ä¸æ˜¯è‡ªå·±åˆ›å»ºå¯¹è±¡çš„æ‰€æœ‰æƒã€‚ä»¥ä¸‹ä¸¤ç§æƒ…å†µä½¿ç”¨<code>retain</code>:<ol>
<li>åœ¨<code>accessor method</code>æˆ–è€…<code>init method</code>æ–¹æ³•è·å–æ‰€éœ€è¦çš„å¯¹è±¡æ‰€æœ‰æƒä¸ºå±æ€§<code>property</code> ã€‚</li>
<li>éœ€è¦æ“ä½œå¯¹è±¡æ—¶ï¼Œé¿å…å¯¹è±¡è¢«é‡Šæ”¾è€Œå¯¼è‡´é”™è¯¯ï¼Œéœ€è¦<code>retain</code>æŒæœ‰å¯¹è±¡ã€‚</li>
</ol>
</li>
<li>å‘é€<code>release</code>, <code>autorelease</code>æ¶ˆæ¯æ¥é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡ã€‚</li>
<li>ä¸è¦ä¸æ˜¯ä½ åˆ›å»ºçš„å¯¹è±¡å’Œæ²¡æœ‰æ‰€æœ‰æƒçš„å¯¹è±¡å‘é€<code>release</code>æ¶ˆæ¯ã€‚</li>
</ul>
<h4 id="Practical-Memory-Management-å®é™…å†…å­˜ç®¡ç†"><a href="#Practical-Memory-Management-å®é™…å†…å­˜ç®¡ç†" class="headerlink" title="Practical Memory Management å®é™…å†…å­˜ç®¡ç†"></a>Practical Memory Management å®é™…å†…å­˜ç®¡ç†</h4><ul>
<li><p>Autorelease pools</p>
<ul>
<li>å‘å¯¹è±¡å‘é€<code>autorelease</code>æ¶ˆæ¯ï¼Œä¼šå°†å¯¹è±¡æ ‡è®°ä¸ºå»¶è¿Ÿé‡Šæ”¾ï¼Œå½“å¯¹è±¡è¶…å‡ºå½“å‰ä½œç”¨åŸŸæ—¶ï¼Œé‡Šæ”¾å¯¹è±¡ã€‚</li>
<li><p><code>AppKit frameworks</code>å’Œ<code>UIKit frameworks</code>åœ¨äº‹ä»¶å¾ªç¯çš„æ¯ä¸ªå‘¨æœŸå¼€å§‹æ—¶ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸Šåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¹¶åœ¨æ­¤æ¬¡æ—¶é—´å¾ªç¯ç»“æŸæ—¶ï¼Œé‡Šæ”¾å®ƒï¼Œä»è€Œé‡Šæ”¾åœ¨å¤„ç†æ—¶ç”Ÿæˆçš„æ‰€æœ‰è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œé€šå¸¸ä¸éœ€è¦è‡ªå·±åˆ›å»º<code>autoreleasePool</code>ï¼Œå½“ç„¶ï¼Œä»¥ä¸‹æƒ…å†µä½ éœ€è¦è‡ªå·±åˆ›å»ºå’Œé”€æ¯<code>autoreleasePool</code>ï¼š</p>
<ol>
<li>å¦‚æœä½ ç¼–å†™çš„ä»£ç ä¸æ˜¯åŸºäº<code>UI framework</code>çš„ç¨‹åºï¼Œå¦‚<code>command-line tool</code>å‘½ä»¤è¡Œå·¥å…·ã€‚</li>
<li>å¦‚æœä½ éœ€è¦å†™ä¸€ä¸ªå¾ªç¯ï¼Œåˆ›å»ºè®¸å¤šä¸´æ—¶å¯¹è±¡ï¼Œå¦‚è¯»å…¥å¤§é‡çš„é“œåƒåŒæ—¶æ”¹å˜å›¾ç‰‡å°ºå¯¸ï¼Œå›¾åƒè¯»å…¥åˆ°<code>NSData</code>å¯¹è±¡ï¼Œå¹¶ä»ä¸­ç”Ÿæˆ<code>UIImage</code>å¯¹è±¡ï¼Œæ”¹å˜è¯¥å¯¹è±¡å°ºå¯¸ç”Ÿæˆæ–°çš„<code>UIImage</code>å¯¹è±¡ã€‚</li>
<li>å¦‚æœä½ åˆ›å»ºä¸€ä¸ªé•¿æœŸå­˜åœ¨çº¿ç¨‹å¹¶ä¸”å¯èƒ½äº§ç”Ÿå¤§é‡çš„<code>autorelease</code>å¯¹è±¡ã€‚</li>
</ol>
</li>
</ul>
</li>
<li><p><code>autoreleasePool</code>æ¨èä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">	<span class="comment">//do something</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>dealloc</p>
</li>
<li><p>å½“<code>NSObject</code>å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œé”€æ¯è¯¥å¯¹è±¡å‰ä¼šè°ƒç”¨<code>dealloc</code>æ–¹æ³•ï¼Œç”¨æ¥é‡Šæ”¾è¯¥å¯¹è±¡æ‹¥æœ‰çš„æ‰€æœ‰èµ„æºï¼ŒåŒ…è£¹å®ä¾‹å˜é‡æŒ‡å‘çš„å¯¹è±¡ã€‚<br>  ä¾‹å­:</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//	MRR</span></div><div class="line">- (<span class="keyword">void</span>)dealloc&#123;</div><div class="line">   [_firstName release];</div><div class="line">   [_lastName release];</div><div class="line">   [<span class="keyword">super</span> dealloc];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Important: Never invoke another objectâ€™s dealloc method directly.You must invoke the superclassâ€™s implementation at the end of your implementation.You should not tie management of system resources to object lifetimes; see Donâ€™t Use dealloc to Manage Scarce Resources.When an application terminates, objects may not be sent a dealloc message. Because the processâ€™s memory is automatically cleared on exit, it is more efficient simply to allow the operating system to clean up resources than to invoke all the memory management methods.<br>ä¸è¦ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„deallocæ–¹æ³•ã€‚<br>ä½ å¿…é¡»åœ¨ç±»ä½¿ç”¨ç»“æŸæ—¶è°ƒç”¨çˆ¶ç±»çš„å®ç°ã€‚<br>ä½ ä¸åº”è¯¥æŠŠç³»ç»Ÿèµ„æºä¸å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šã€‚<br>å› ä¸ºè¿›ç¨‹çš„å†…å­˜é€€å‡ºæ—¶ï¼Œå¯¹è±¡å¯èƒ½æ— æ³•å‘é€deallocæ¶ˆæ¯,è¯¥æ–¹æ³•çš„å†…å­˜è¢«è‡ªåŠ¨é€€å‡ºæ¸…é›¶,æ‰€ä»¥è®©æ“ä½œç³»ç»Ÿæ¸…ç†èµ„æºæ¯”è°ƒç”¨æ‰€æœ‰çš„å†…å­˜ç®¡ç†æ–¹æ³•æ›´æœ‰æ•ˆã€‚</p>
</blockquote>
<h3 id="å†…å­˜ç®¡ç†å®è·µ"><a href="#å†…å­˜ç®¡ç†å®è·µ" class="headerlink" title="å†…å­˜ç®¡ç†å®è·µ"></a>å†…å­˜ç®¡ç†å®è·µ</h3><h4 id="ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ä½¿å†…å­˜ç®¡ç†æ›´è½»æ¾"><a href="#ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ä½¿å†…å­˜ç®¡ç†æ›´è½»æ¾" class="headerlink" title="ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ä½¿å†…å­˜ç®¡ç†æ›´è½»æ¾"></a>ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ä½¿å†…å­˜ç®¡ç†æ›´è½»æ¾</h4><blockquote>
<p>å¦‚æœç±»æœ‰ä¸€ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½ å¿…é¡»ç¡®ä¿ä½¿ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œå®ƒä¸ä¼šè¢«é‡Šæ”¾ã€‚å› æ­¤åœ¨è®¾ç½®æ—¶ï¼Œå¿…é¡»å£°æ˜å¯¹è±¡çš„æ‰€æœ‰æƒã€‚è¿˜å¿…é¡»ä¿è¯æŒæœ‰è¿™äº›å¯¹è±¡æ‰€æœ‰æƒçš„æ”¾å¼ƒã€‚</p>
</blockquote>
<ul>
<li>ä½¿ç”¨<code>set</code>å’Œ<code>get</code>æ–¹æ³•æ¥å®ç°ï¼Œæ›´æ–¹ä¾¿ç®¡ç†å†…å­˜ï¼ˆä¸»è¦æ˜¯çœå†™å¾ˆå¤š<code>retain</code>å’Œ<code>release</code>ï¼‰ã€‚<br>ä¾‹å­å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Counter</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSNumber</span> *count;</div><div class="line"><span class="keyword">@end</span>;</div></pre></td></tr></table></figure>
<p><code>Counter</code>ç±»æœ‰ä¸€ä¸ªå±æ€§æ˜¯<code>NSNumber</code>å¯¹è±¡ï¼Œå±æ€§å£°æ˜äº†<code>set</code>å’Œ<code>get</code>ä¸¤ä¸ªè®¿é—®å™¨æ–¹æ³•ï¼Œåœ¨<code>get</code>ä¸­å°±æ˜¯è¿”å›<code>synthesized</code>å®ä¾‹å˜é‡ï¼Œæ‰€ä»¥æ²¡å¿…è¦<code>retain</code>æˆ–è€…<code>release</code>ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSNumber</span> *)count &#123;</div><div class="line">	<span class="keyword">return</span> _count;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>set</code>æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setCount:(<span class="built_in">NSNumber</span> *)newCount &#123;</div><div class="line">    [newCount <span class="keyword">retain</span>]; <span class="comment">// å…ˆ`retain`ç¡®ä¿æ–°æ•°æ®ä¸è¢«é‡Šæ”¾</span></div><div class="line">    [_count release];  <span class="comment">// é‡Šæ”¾æ—§å¯¹è±¡æ‰€æœ‰æƒ</span></div><div class="line">    <span class="comment">// Make the new assignment.</span></div><div class="line">    _count = newCount; 	<span class="comment">// å°†æ–°å€¼èµ‹ç»™_count</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…ˆ<code>retain</code>ç¡®ä¿æ–°æ•°æ®ä¸è¢«é‡Šæ”¾ï¼Œé‡Šæ”¾æ—§çš„å¯¹è±¡æ‰€æœ‰æƒ(Objective-Cå…è®¸å‘<code>nil</code>å‘é€æ¶ˆæ¯)ã€‚ä½ å¿…é¡»åœ¨<code>[newCount retain]</code>ä¹‹åå†<code>[_count release]</code>ç¡®ä¿å¤–éƒ¨ä¸ä¼šè¢«<code>dealloc</code>ã€‚</p>
<h4 id="ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•è®¾ç½®å±æ€§"><a href="#ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•è®¾ç½®å±æ€§" class="headerlink" title="ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•è®¾ç½®å±æ€§"></a>ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•è®¾ç½®å±æ€§</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ–¹æ³•ä¸€</span></div><div class="line">- (<span class="keyword">void</span>)reset &#123;</div><div class="line">    <span class="built_in">NSNumber</span> *zero = [[<span class="built_in">NSNumber</span> alloc] initWithInteger:<span class="number">0</span>];</div><div class="line">    [<span class="keyword">self</span> setCount:zero];</div><div class="line">    [zero release];</div><div class="line">&#125;</div><div class="line"><span class="comment">// æ–¹æ³•äºŒ</span></div><div class="line">- (<span class="keyword">void</span>)reset &#123;</div><div class="line">    <span class="built_in">NSNumber</span> *zero = [[<span class="built_in">NSNumber</span> alloc] initWithInteger:<span class="number">0</span>];</div><div class="line">    [_count release];</div><div class="line">    _count = zero;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–¹æ³•äºŒæ²¡æœ‰å¯¹<code>count</code>å±æ€§èµ‹æ–°å€¼æ—¶æ²¡æœ‰ä½¿ç”¨<code>set</code>è®¿é—®æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè§¦å‘<code>KVO</code>ï¼Œå¯èƒ½åœ¨ç‰¹æ®Šæƒ…å†µå¯¼è‡´é”™è¯¯ï¼ˆæ¯”å¦‚å¿˜è®°äº† <code>retain</code>æˆ–è€…<code>release</code>ï¼Œæˆ–è€…å¦‚æœå®ä¾‹å˜é‡çš„å†…å­˜ç®¡ç†å‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚é™¤äº†ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨<code>self.count = zero;</code>ã€‚</p>
<h4 id="ä¸è¦åœ¨åˆå§‹åŒ–å’Œdeallocä¸­ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•"><a href="#ä¸è¦åœ¨åˆå§‹åŒ–å’Œdeallocä¸­ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•" class="headerlink" title="ä¸è¦åœ¨åˆå§‹åŒ–å’Œdeallocä¸­ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•"></a>ä¸è¦åœ¨åˆå§‹åŒ–å’Œ<code>dealloc</code>ä¸­ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•</h4><p>ä¸åº”è¯¥ä½¿ç”¨<code>set</code>å’Œ<code>get</code>æ–¹æ³•åœ¨<code>init</code>å’Œ<code>dealloc</code>ã€‚åº”è¯¥ä½¿ç”¨<code>_</code>ç›´æ¥è®¿é—®æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–å’Œ<code>dealloc</code>ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- init &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _count = [[<span class="built_in">NSNumber</span> alloc] initWithInteger:<span class="number">0</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// ç”±äºCounterç±»å…·æœ‰å¯¹è±¡å®ä¾‹å˜é‡ï¼Œå› æ­¤è¿˜å¿…é¡»å®ç°deallocæ–¹æ³•ã€‚</span></div><div class="line"><span class="comment">// å®ƒåº”è¯¥é€šè¿‡å‘ä»»ä½•å®ä¾‹å˜é‡å‘é€ä¸€ä¸ªé‡Šæ”¾æ¶ˆæ¯æ¥æ”¾å¼ƒå®ƒçš„æ‰€æœ‰æƒï¼Œæœ€ç»ˆå®ƒåº”è¯¥è°ƒç”¨superçš„å®ç°</span></div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line">    [_count release];</div><div class="line">    [<span class="keyword">super</span> dealloc];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨å¼±å¼•ç”¨æ¥é¿å…å¾ªç¯å¼•ç”¨"><a href="#ä½¿ç”¨å¼±å¼•ç”¨æ¥é¿å…å¾ªç¯å¼•ç”¨" class="headerlink" title="ä½¿ç”¨å¼±å¼•ç”¨æ¥é¿å…å¾ªç¯å¼•ç”¨"></a>ä½¿ç”¨å¼±å¼•ç”¨æ¥é¿å…å¾ªç¯å¼•ç”¨</h4><ul>
<li><code>retain</code>å¯¹è±¡ï¼Œå®é™…æ˜¯å¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨(strong reference),ä¸€ä¸ªå¯¹è±¡åœ¨æ‰€æœ‰å¼ºå¼•ç”¨éƒ½æ²¡æœ‰è¢«é‡Šæ”¾ä¹‹å‰ï¼Œä¸èƒ½é‡Šæ”¾å¯¹è±¡ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå¯¹è±¡äº’ç›¸æŒæœ‰å¯¹æ–¹æˆ–è€…é—´æ¥äº’ç›¸å¼•ç”¨ï¼Œä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ã€‚è¿™æ—¶å€™å°±éœ€è¦å¼±å¼•ç”¨å¯¹æ–¹æ¥æ‰“ç ´è¿™ä¸ªå¾ªç¯ã€‚</li>
</ul>
<p>å¦‚çˆ¶äº²å¼ºå¼•ç”¨å„¿å­ï¼Œå„¿å­å¼ºå¼•ç”¨å­™å­ï¼Œé‚£ä¹ˆå€’è¿‡æ¥å­™å­åªèƒ½å¼±å¼•ç”¨å„¿å­ï¼Œå„¿å­ä¹Ÿåªèƒ½å¼±å¼•ç”¨çˆ¶äº²ã€‚<code>Cocoa</code>å»ºç«‹äº†ä¸€ä¸ªçº¦å®šï¼Œå‰¯å¯¹è±¡åº”è¯¥å¼ºå¼•ç”¨å­å¯¹è±¡ï¼Œå¹¶ä¸”å­å¯¹è±¡åº”è¯¥åªå¯¹çˆ¶å¯¹è±¡å¼±å¼•ç”¨ã€‚<br><code>Cocoa</code>ä¸­å¸¸è§çš„ä¾‹å­åŒ…æ‹¬ä»£ç†æ–¹æ³•<code>delegate</code>ï¼Œ<code>data source</code>,<code>observer</code>,<code>target</code>ç­‰ç­‰</p>
<p>å¿…é¡»å°å¿ƒå°†æ¶ˆæ¯å‘é€åˆ°æŒæœ‰åªæ˜¯ä¸€ä¸ªå¼±å¼•ç”¨çš„å¯¹è±¡ã€‚å½“å‘é€æ¶ˆæ¯ç»™ä¸€ä¸ªè¢«<code>dealloc</code>çš„å¼±å¼•ç”¨å¯¹è±¡æ—¶ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¼šå´©æºƒï¼ˆè¿™æ˜¯åœ¨<code>MRR</code>æ—¶æœŸçš„ä»£ç†<code>delegate</code>ä¼šå‡ºç°ï¼Œå› ä¸ºå½“æ—¶å¯¹ä»£ç†å¼±å¼•ç”¨çš„ä¿®é¥°ç¬¦æ˜¯<code>assign</code>,<code>assign</code>å¼±å¼•ç”¨å¹¶ä¸ä¼šåœ¨å¯¹è±¡<code>dealloc</code>æ—¶ï¼ŒæŠŠå¯¹è±¡ç½®ä¸º<code>nil</code>ã€‚è€Œ<code>ARC</code>æ—¶ä»£ä½¿ç”¨<code>weak</code>åˆ™ä¼šåœ¨å¯¹è±¡<code>dealloc</code>æ—¶ç½®ä¸º<code>nil</code>ï¼‰ã€‚</p>
<h4 id="é¿å…æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾"><a href="#é¿å…æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾" class="headerlink" title="é¿å…æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾"></a>é¿å…æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾</h4><ul>
<li><code>Cocoa</code>çš„æ‰€æœ‰æƒç­–ç•¥è§„å®šæ¥æ”¶çš„å¯¹è±¡é€šå¸¸åœ¨æ•´ä¸ªè°ƒç”¨æ–¹æ³•çš„èŒƒå›´å†…ä¿è¯æœ‰æ•ˆã€‚è¿˜åº”è¯¥æ˜¯åœ¨å½“å‰æ–¹æ³•èŒƒå›´å†…ï¼Œè€Œä¸å¿…æ‹…å¿ƒå®ƒè¢«é‡Šæ”¾ã€‚å¯¹è±¡çš„<code>getter</code>æ–¹æ³•è¿”å›ä¸€ä¸ªç¼“å­˜çš„å®ä¾‹å˜é‡æˆ–è€…ä¸€ä¸ªè®¡ç®—çš„å€¼ï¼Œè¿™ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ï¼Œå¯¹è±¡åœ¨éœ€è¦çš„ä½¿ç”¨æ—¶è¿˜æ˜¯æœ‰æ•ˆçš„ã€‚</li>
<li><p>æœ‰ä¸¤ç±»ä¾‹å¤–æƒ…å†µï¼š</p>
<ul>
<li><p>å½“ä¸€ä¸ªå¯¹è±¡ä»åŸºæœ¬çš„é›†åˆç±»åˆ é™¤æ—¶</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">heisenObject = [array objectAtIndex:n];</div><div class="line">[array removeObjectAtIndex:n];</div><div class="line"><span class="comment">// heisenObject ç°åœ¨å¯èƒ½æ— æ•ˆ</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- `n`ä»é›†åˆ`array`åˆ é™¤æ—¶ä¹Ÿä¼šå‘`n`å‘é€`release`ï¼ˆè€Œä¸æ˜¯`autorelease`ï¼‰æ¶ˆæ¯ã€‚å¦‚æœ`array`é›†åˆæ—¶è¢«åˆ é™¤`n`å¯¹è±¡çš„å”¯ä¸€æ‹¥æœ‰è€…ï¼Œè¢«ç§»é™¤çš„å¯¹è±¡`n`æ˜¯ç«‹å³è¢«é‡Šæ”¾çš„ã€‚`heisenObject`å¹¶æ²¡æœ‰å¯¹`n`è¿›è¡Œ`retain`ï¼Œæ‰€ä»¥å½“`n`ä»`array`åˆ é™¤æ—¶åŒæ—¶è¢«é‡Šæ”¾ã€‚

**æ­£ç¡®çš„åšæ³•**

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">heisenObject = [[array objectAtIndex:n] <span class="keyword">retain</span>];</div><div class="line">[array removeObjectAtIndex:n];</div><div class="line"><span class="comment">// Use heisenObject...</span></div><div class="line">[heisenObject release];</div></pre></td></tr></table></figure>

- å½“ä¸€ä¸ªçˆ¶å¯¹è±¡è¢«é‡Šæ”¾æ—¶

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> parent = &lt;<span class="meta">#create a parent object#&gt;;</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">heisenObject = [parent child] ;</div><div class="line">[parent release]; <span class="comment">// Or, for example: self.parent = nil;</span></div><div class="line"><span class="comment">// heisenObject ç°åœ¨å¯èƒ½æ— æ•ˆ</span></div></pre></td></tr></table></figure>
</code></pre><ul>
<li>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»å¦ä¸€ä¸ªå¯¹è±¡è·å–çš„å¯¹è±¡ï¼Œç„¶åç›´æ¥æˆ–è€…é—´æ¥çš„é‡Šæ”¾è´Ÿå¯¹è±¡ã€‚å¦‚æœé‡Šæ”¾çˆ¶å¯¹è±¡å¯¼è‡´å®ƒè¢«é‡Šæ”¾ï¼Œå¹¶ä¸”çˆ¶å¯¹è±¡æ˜¯å­å¯¹è±¡å”¯ä¸€æ‰€æœ‰è€…ï¼Œé‚£ä¹ˆå­å¯¹è±¡<code>heisenObject</code>å°†è¢«åŒä¸€æ—¶é—´é‡Šæ”¾ã€‚æ‰€ä»¥æ­£ç¡®çš„åšæ³•è¿˜æ˜¯å­å¯¹è±¡<code>heisenObject</code>è·å–çš„æ—¶å€™å…ˆ<code>retain</code>ä¸€æ¬¡ã€‚</li>
</ul>
<h4 id="Collectionsç±»æ‹¥æœ‰å®ƒä»¬æ‰€åŒ…å«çš„å¯¹è±¡æ‰€æœ‰æƒ"><a href="#Collectionsç±»æ‹¥æœ‰å®ƒä»¬æ‰€åŒ…å«çš„å¯¹è±¡æ‰€æœ‰æƒ" class="headerlink" title="Collectionsç±»æ‹¥æœ‰å®ƒä»¬æ‰€åŒ…å«çš„å¯¹è±¡æ‰€æœ‰æƒ"></a>Collectionsç±»æ‹¥æœ‰å®ƒä»¬æ‰€åŒ…å«çš„å¯¹è±¡æ‰€æœ‰æƒ</h4><ul>
<li>æ·»åŠ ä¸€ä¸ªå¯¹è±¡åˆ°ä¸€ä¸ª<code>collection</code>ä¸­ï¼Œå¦‚(æ•°ç»„ã€å­—å…¸ã€é›†åˆ)æ—¶ï¼Œ<code>collection</code>ä¼šå¾—åˆ°è¯¥å¯¹è±¡æ‰€æœ‰æƒã€‚å½“å¯¹è±¡ä»<code>collection</code>åˆ é™¤æˆ–è€…<code>collection</code>è‡ªå·±è¢«é‡Šæ”¾æ—¶ï¼Œ<code>collection</code>å°†é‡Šæ”¾å®ƒæ‹¥æœ‰çš„æ‰€æœ‰æƒã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSMutableArray</span> *array = &lt;<span class="meta">#Get a mutable array#&gt;;</span></div><div class="line"><span class="built_in">NSUInteger</span> i;</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">    <span class="built_in">NSNumber</span> *allocedNumber = [[<span class="built_in">NSNumber</span> alloc] initWithInteger:i];</div><div class="line">    [array addObject:allocedNumber];</div><div class="line">    [allocedNumber release];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="é€šè¿‡å¼•ç”¨è®¡æ•°å®ç°æ‰€æœ‰æ‰€æœ‰æƒç­–ç•¥"><a href="#é€šè¿‡å¼•ç”¨è®¡æ•°å®ç°æ‰€æœ‰æ‰€æœ‰æƒç­–ç•¥" class="headerlink" title="é€šè¿‡å¼•ç”¨è®¡æ•°å®ç°æ‰€æœ‰æ‰€æœ‰æƒç­–ç•¥"></a>é€šè¿‡å¼•ç”¨è®¡æ•°å®ç°æ‰€æœ‰æ‰€æœ‰æƒç­–ç•¥</h4><ul>
<li><p>æ‰€æœ‰åœˆç­–ç•¥æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°å®ç°çš„ï¼Œé€šå¸¸<code>retain</code>æ–¹æ³•åè¢«ç§°ä¸º<code>retain count</code>ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚</p>
<ul>
<li>å½“ä½ åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°ä¸º<code>1</code></li>
<li>å½“ä½ ç»™å¯¹è±¡å‘é€<code>retain</code>æ¶ˆæ¯ï¼Œå¼•ç”¨è®¡æ•°<code>+1</code></li>
<li>å½“ä½ ç»™å¯¹è±¡å‘é€<code>release</code>æ¶ˆæ¯ï¼Œå¼•ç”¨è®¡æ•°<code>-1</code></li>
<li>å½“ä½ ç»™å¯¹è±¡å‘é€ä¸€ä¸ª<code>autorelease</code>æ¶ˆæ¯ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°å™¨å°†åœ¨å½“å‰çš„è‡ªåŠ¨é‡Šæ”¾æ± ç»“æŸå<code>-1</code></li>
<li>å½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º<code>0</code>æ—¶å°†è¢«é‡Šæ”¾</li>
</ul>
</li>
</ul>
<h2 id="ARCæ—¶ä»£"><a href="#ARCæ—¶ä»£" class="headerlink" title="# ARCæ—¶ä»£"></a># ARCæ—¶ä»£</h2><h3 id="æ¦‚è¦-1"><a href="#æ¦‚è¦-1" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h3><p>iOS5åå‡ºç°äº†<code>ARC</code>ã€‚é‚£ä¹ˆ<code>ARC</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>è‡ªåŠ¨å¼•ç”¨è®¡æ•°<code>ARC</code>æ˜¯ä¸€ç§ç¼–è¯‘å™¨çš„åŠŸèƒ½ï¼Œä¸º<code>Objective-C</code>å¯¹è±¡æä¾›äº†è‡ªåŠ¨åŒ–çš„å†…å­˜ç®¡ç†ã€‚<br>åœ¨<code>ARC</code>ä¸éœ€è¦å¼€å‘è€…è€ƒè™‘ä¿ç•™æˆ–è€…é‡Šæ”¾çš„æ“ä½œï¼Œå°±æ˜¯ä¸ç”¨è‡ªå·±æ‰‹åŠ¨<code>retain</code>ã€<code>release</code>å’Œ<code>autorelease</code>ï¼ˆğŸ˜„å¼€å¿ƒï¼‰ï¼Œè®©å¼€å‘è€…å¯ä»¥ä¸“æ³¨å†™æœ‰è¶£çš„ä»£ç ã€‚</p>
<p><strong>å½“ç„¶<code>ARC</code>ä¾ç„¶æ˜¯åŸºäºå¼•ç”¨è®¡æ•°ç®¡ç†å†…å­˜ã€‚</strong></p>
<h3 id="ARC-å¼ºåˆ¶æ–°è§„åˆ™"><a href="#ARC-å¼ºåˆ¶æ–°è§„åˆ™" class="headerlink" title="ARC å¼ºåˆ¶æ–°è§„åˆ™"></a>ARC å¼ºåˆ¶æ–°è§„åˆ™</h3><p><code>ARC</code>ç›¸å¯¹äº<code>MRR</code>å¼ºåˆ¶åŠ äº†ä¸€äº›æ–°çš„è§„åˆ™ã€‚</p>
<ul>
<li>ä½ ä¸èƒ½ä¸»åŠ¨è°ƒç”¨<code>dealloc</code>ã€æˆ–è€…è°ƒç”¨<code>retain</code>,<code>release</code>, <code>retainCount</code>,<code>autorelease</code>å°±æ˜¯è¿™äº›éƒ½ä¸ç”¨ä½ å†™äº†ã€‚ä¹Ÿä¸èƒ½<code>@selector(retain)</code>, <code>@selector(release)</code>è¿™æ ·å­è°ƒç”¨ã€‚</li>
<li>ä½ å¯ä»¥å®ç°ä¸€ä¸ª<code>dealloc</code>æ–¹æ³•ï¼Œå¦‚æœä½ éœ€è¦ç®¡ç†èµ„æºè€Œä¸æ˜¯é‡Šæ”¾å®ä¾‹å˜é‡(æ¯”å¦‚è§£é™¤ç›‘å¬ã€é‡Šæ”¾å¼•ç”¨ã€socket closeç­‰ç­‰)ã€‚åœ¨é‡å†™<code>dealloc</code>åéœ€è¦<code>[super dealloc]</code>ï¼ˆåœ¨æ‰‹åŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°æ—¶æ‰éœ€è¦ï¼‰ã€‚</li>
<li>ä»ç„¶å¯ä»¥ä½¿ç”¨<code>CFRetain</code>ï¼Œ<code>CFRelease</code>ç­‰å…¶å®ƒå¯¹è±¡ã€‚</li>
<li>ä½ ä¸èƒ½ä½¿ç”¨<code>NSAllocateObject</code>æˆ–è€…<code>NSDeallocateObject</code>ã€‚</li>
<li>ä½ ä¸èƒ½ä½¿ç”¨<code>C</code>ç»“æ„ä½“ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª<code>Objective-C</code>ç±»å»ç®¡ç†æ•°æ®è€Œä¸æ˜¯ä¸€ä¸ªç»“æ„ä½“ã€‚</li>
<li><code>id</code>å’Œ<code>void</code>æ²¡æœ‰è½¬æ¢å…³ç³»,ä½ å¿…é¡»ä½¿ç”¨<code>cast</code>ç‰¹æ®Šæ–¹å¼ï¼Œä»¥ä¾¿åœ¨ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’çš„<code>Objective-C</code>å¯¹è±¡å’Œ<code>Core Foundation</code>ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</li>
<li>ä½ ä¸èƒ½ä½¿ç”¨<code>NSAutoreleasePool</code>ï¼Œä½¿ç”¨<code>@autoreleasepool</code>ã€‚</li>
<li>æ²¡å¿…è¦ä½¿ç”¨<code>NSZone</code></li>
</ul>
<h3 id="ARC-ä½¿ç”¨æ–°ä¿®é¥°ç¬¦"><a href="#ARC-ä½¿ç”¨æ–°ä¿®é¥°ç¬¦" class="headerlink" title="ARC ä½¿ç”¨æ–°ä¿®é¥°ç¬¦"></a>ARC ä½¿ç”¨æ–°ä¿®é¥°ç¬¦</h3><ul>
<li><code>__strong</code> å¼ºå¼•ç”¨,ç”¨æ¥ä¿è¯å¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ã€‚</li>
<li><code>__weak</code>å¼±å¼•ç”¨ é‡Šæ”¾æ—¶ä¼šç½®ä¸º<code>nil</code></li>
<li><code>__unsafe_unretained</code>å¼±å¼•ç”¨ å¯èƒ½ä¸å®‰å…¨ï¼Œå› ä¸ºé‡Šæ”¾æ—¶ä¸ç½®ä¸º<code>nil</code>ã€‚</li>
<li><code>__autoreleasing</code>å¯¹è±¡è¢«æ³¨å†Œåˆ°<code>autorelease pool</code>ä¸­æ–¹æ³•åœ¨è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚</li>
</ul>
<h3 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h3><p><code>ARC</code>è¿˜æ˜¯åŸºäºå¼•ç”¨è®¡æ•°çš„ç®¡ç†æœºåˆ¶æ‰€ä»¥ä¾ç„¶ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ã€‚</p>
<h4 id="blockä½¿ç”¨ä¸­å‡ºç°å¾ªç¯å¼•ç”¨"><a href="#blockä½¿ç”¨ä¸­å‡ºç°å¾ªç¯å¼•ç”¨" class="headerlink" title="blockä½¿ç”¨ä¸­å‡ºç°å¾ªç¯å¼•ç”¨"></a>blockä½¿ç”¨ä¸­å‡ºç°å¾ªç¯å¼•ç”¨</h4><ul>
<li>å¸¸è§çš„æœ‰æƒ…å†µåœ¨<code>block</code>ä½¿ç”¨ä¸­å‡ºç°å¾ªç¯å¼•ç”¨</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æƒ…å†µä¸€</span></div><div class="line"><span class="keyword">self</span>.myBlock = ^&#123;</div><div class="line"><span class="keyword">self</span>.objc = ...;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// æƒ…å†µäºŒ</span></div><div class="line">Dog *dog = [[Dog alloc] init];</div><div class="line">dog.myBlock = ^&#123;</div><div class="line">	 <span class="comment">// do something</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">self</span>.dog = dog;</div></pre></td></tr></table></figure>
<pre><code>- è§£å†³æ–¹æ³•

<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span> (<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</div><div class="line"><span class="keyword">self</span>.myBlock = ^&#123;</div><div class="line">weakSelf.objc = ...;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>é‚£ä¹ˆå¦‚æœ<code>block</code>å†…ä½¿ç”¨äº†<code>self</code>è¿™ä¸ªæ—¶å€™å¦‚æœæŸä¸€ä¸ªæ—¶åˆ»<code>self</code>è¢«é‡Šæ”¾å°±ä¼šå¯¼è‡´å‡ºç°é—®é¢˜ã€‚</p>
</li>
<li><p>è§£å†³æ–¹æ³•</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span> (<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</div><div class="line"><span class="keyword">self</span>.myBlock = ^&#123;</div><div class="line">__<span class="keyword">strong</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) strongSelf = weakSelf;</div><div class="line">strongSelf.objc1 = ...;</div><div class="line">strongSelf.objc2 = ...;</div><div class="line">strongSelf.objc3 = ...;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>__weak</code>æ‰“ç ´å¾ªç¯å¼•ç”¨ã€‚<code>__strong</code>ç”¨æ¥é¿å…åœ¨ä½¿ç”¨<code>self</code>è¿‡ç¨‹ä¸­<code>self</code>è¢«é‡Šæ”¾ï¼Œ<code>__strong</code>åœ¨<code>block</code>åä¼šè°ƒç”¨<code>objc_release(obj)</code>é‡Šæ”¾å¯¹è±¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> __<span class="keyword">strong</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">	</div><div class="line"><span class="comment">// clang ç¼–è¯‘å</span></div><div class="line"><span class="keyword">id</span> obj = objc_msgSend(<span class="built_in">NSObject</span>, <span class="keyword">@selector</span>(alloc));</div><div class="line">objc_msgSend(obj, <span class="keyword">@selector</span>(init));</div><div class="line">objc_release(obj);</div></pre></td></tr></table></figure>
<p>ä¸¤æ¬¡è°ƒç”¨<code>objc_msgSend</code>å¹¶åœ¨å˜é‡ä½œç”¨åŸŸç»“æŸæ—¶è°ƒç”¨<code>objc_release</code>é‡Šæ”¾å¯¹è±¡ï¼Œä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p>
<h4 id="NSTimerå¾ªç¯å¼•ç”¨"><a href="#NSTimerå¾ªç¯å¼•ç”¨" class="headerlink" title="NSTimerå¾ªç¯å¼•ç”¨"></a>NSTimerå¾ªç¯å¼•ç”¨</h4><p>ä¸ºä»€ä¹ˆ<code>NSTimer</code>ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨å‘¢ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSTimer</span> *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti </div><div class="line">									  target:(<span class="keyword">id</span>)aTarget </div><div class="line">									  selector:(SEL)aSelector </div><div class="line">									  userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo </div><div class="line">									  repeats:(<span class="built_in">BOOL</span>)yesOrNo;</div><div class="line">									  </div><div class="line">									  </div><div class="line">+ (<span class="built_in">NSTimer</span> *)scheduledTimerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti </div><div class="line">										        target:(<span class="keyword">id</span>)aTarget </div><div class="line">										        selector:(SEL)aSelector </div><div class="line">										        userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo </div><div class="line">										        repeats:(<span class="built_in">BOOL</span>)yesOrNo;</div></pre></td></tr></table></figure>
<ul>
<li><p>ä¸»è¦æ˜¯å› ä¸º<code>NSRunloop</code>è¿è¡Œå¾ªç¯ä¿æŒäº†å¯¹<code>NSTimer</code>çš„å¼ºå¼•ç”¨ï¼Œå¹¶ä¸”<code>NSTimer</code>çš„<code>targer</code>ä¹Ÿä½¿ç”¨äº†å¼ºå¼•ç”¨ã€‚</p>
</li>
<li><p>æ¥è‡ªæ–‡æ¡£<a href="https://developer.apple.com/reference/foundation/nstimer?language=objc" target="_blank" rel="external">NSTimer</a></p>
</li>
</ul>
<blockquote>
<p>Note in particular that run loops maintain strong references to their timers, so you donâ€™t have to maintain your own strong reference to a timer after you have added it to a run loop.<br><strong>target</strong><br>The object to which to send the message specified by aSelector when the timer fires. The timer maintains a strong reference to this object until it (the timer) is invalidated.</p>
</blockquote>
<p>ä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">viewControllerDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimer</span> *timer;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"> - (<span class="keyword">void</span>)viewDidLoad</div><div class="line"> &#123;</div><div class="line">     [<span class="keyword">super</span> viewDidLoad];</div><div class="line">     <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1</span></div><div class="line">                                               target:<span class="keyword">self</span> </div><div class="line">                                             selector:<span class="keyword">@selector</span>(onTimeOut:) </div><div class="line">                                             userInfo:<span class="literal">nil</span> </div><div class="line">                                              repeats:<span class="literal">NO</span>];</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œæ§åˆ¶å™¨å¼ºå¼•ç”¨äº†<code>timer</code>ï¼Œè€Œ<code>timer</code>ä¹Ÿå¼ºå¼•ç”¨äº†æ§åˆ¶å™¨,è¿™ä¸ªæ—¶å€™å°±æ˜¯å¾ªç¯å¼•ç”¨äº†ï¼Œå¼•ç”¨å…³ç³»å¦‚ä¸‹å›¾ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">timer-&gt;æ§åˆ¶å™¨:strong</div><div class="line">æ§åˆ¶å™¨-&gt;timer:strong</div></pre></td></tr></table></figure>
<ul>
<li>é‚£ä¹ˆå¦‚æœæ§åˆ¶å™¨å¯¹<code>timer</code>ä½¿ç”¨äº†<code>weak</code>å‘¢ï¼Ÿ<br>ä½¿ç”¨<code>weak</code>æ˜¯æ‰“ç ´äº†å¾ªç¯å¼•ç”¨,ä½†æ˜¯<code>run loop</code>è¿˜æ˜¯å¼ºå¼•ç”¨ç€<code>timer</code>,<code>timer</code>åˆå¼ºå¼•ç”¨ç€æ§åˆ¶å™¨ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å¼•ç”¨å…³ç³»å¦‚ä¸‹å›¾ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">runloop-&gt;timer:strong</div><div class="line">timer-&gt;æ§åˆ¶å™¨:strong</div><div class="line">æ§åˆ¶å™¨--&gt;timer:weak</div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æŠŠ<code>timer</code>åŠ å…¥ä¸»çº¿ç¨‹çš„<code>runloop</code>,ä¸»çº¿ç¨‹ä¸­çš„<code>runloop</code>ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸»çº¿ç¨‹ç»“æŸæ‰ä¼šé”€æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¸»åŠ¨è°ƒç”¨<code>[timer invalidate]</code>,<code>runloop</code>ä¼šä¸€ç›´æŒæœ‰<code>timer</code>ï¼Œ<code>timer</code>åˆæŒæœ‰æ§åˆ¶å™¨ï¼Œé‚£ä¹ˆå°±ä¸€ç›´ä¸ä¼šé‡Šæ”¾æ§åˆ¶å™¨ã€‚</p>
<ul>
<li>è§£å†³æ–¹æ³•ï¼šæ‰‹åŠ¨è°ƒç”¨<code>[timer invalidate]</code>æ¥è§£é™¤æŒæœ‰å…³ç³»ï¼Œé‡Šæ”¾å†…å­˜ã€‚å¯èƒ½ä¼šæƒ³åˆ°åœ¨<code>dealloc</code>æ–¹æ³•ä¸­æ¥æ‰‹åŠ¨è°ƒç”¨ï¼Œä½†æ˜¯å› ä¸º<code>timer</code>æŒæœ‰æ§åˆ¶å™¨ï¼Œæ‰€ä»¥æ§åˆ¶å™¨çš„<code>dealloc</code>æ–¹æ³•æ°¸è¿œä¸ä¼šè°ƒç”¨ï¼Œå› ä¸º<code>dealloc</code>æ˜¯åœ¨æ§åˆ¶å™¨è¦è¢«é‡Šæ”¾å‰è°ƒç”¨çš„ã€‚åœ¨<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Timers/Articles/usingTimers.html" target="_blank" rel="external">Timer Programming Topics</a>ä¸­æœ‰ç‰¹åˆ«è¯´æ˜ã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢è¿™äº›æ–¹æ³•ä¸­æ‰‹åŠ¨è°ƒç”¨<code>[timer invalidate]</code>ç„¶åç½®ä¸º<code>nil</code>ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewWillDisappear:(<span class="built_in">BOOL</span>)animated; <span class="comment">// Called when the view is dismissed, covered or otherwise hidden. Default does nothing</span></div><div class="line">- (<span class="keyword">void</span>)viewDidDisappear:(<span class="built_in">BOOL</span>)animated;  <span class="comment">// Called after the view was dismissed, covered or otherwise hidden. Default does nothing</span></div></pre></td></tr></table></figure>
<blockquote>
<p>A timer maintains a strong reference to its target. This means that as long as a timer remains valid, its target will not be deallocated. As a corollary, this means that it does not make sense for a timerâ€™s target to try to invalidate the timer in its dealloc methodâ€”the dealloc method will not be invoked as long as the timer is valid.</p>
</blockquote>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="# å‚è€ƒèµ„æ–™"></a># å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html#//apple_ref/doc/uid/10000011-SW1" target="_blank" rel="external">About Memory Management</a></li>
<li><a href="https://developer.apple.com/library/content/releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html" target="_blank" rel="external">Transitioning to ARC Release Notes</a></li>
<li><a href="https://developer.apple.com/reference/foundation/nstimer?language=objc" target="_blank" rel="external">NSTimer</a></li>
<li><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Timers/Articles/usingTimers.html" target="_blank" rel="external">Timer Programming Topics</a></li>
<li><a href="https://book.douban.com/subject/25829244/" target="_blank" rel="external">ã€ŠEffective Objective-C 2.0 ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹</a></li>
<li><a href="https://book.douban.com/subject/24720270/" target="_blank" rel="external">ã€Šobjcé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;# å‰è¨€&quot;&gt;&lt;/a&gt;# å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;åå¤åœ°å¤ä¹ iOSåŸºç¡€çŸ¥è¯†å’ŒåŸç†ï¼Œæ‰“ç£¨çŸ¥è¯†ä½“ç³»æ˜¯éå¸¸é‡è¦çš„ï¼Œæœ¬ç¯‡å°±æ˜¯é‡æ–°æ¸©ä¹ iOSçš„å†…å­˜ç®¡ç†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å†…å­˜ç®¡ç†æ˜¯ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å¯¹è±¡ä¸éœ€è¦æ—¶è¿›è¡Œå†…å­˜é‡Šæ”¾çš„ç¼–ç¨‹è§„èŒƒã€‚&lt;/p&gt;
&lt;h2 id=&quot;MRRæ—¶ä»£&quot;&gt;&lt;a href=&quot;#MRRæ—¶ä»£&quot; class=&quot;headerlink&quot; title=&quot;# MRRæ—¶ä»£&quot;&gt;&lt;/a&gt;# MRRæ—¶ä»£&lt;/h2&gt;&lt;h3 id=&quot;æ¦‚è¦&quot;&gt;&lt;a href=&quot;#æ¦‚è¦&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¦&quot;&gt;&lt;/a&gt;æ¦‚è¦&lt;/h3&gt;&lt;p&gt;Objective-Cå†…å­˜ç®¡ç†ä½¿ç”¨ä½¿ç”¨å¼•ç”¨è®¡æ•°(Reference Counting)æ¥ç®¡ç†å†…å­˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨OS X 10.8ä»¥åä¹Ÿä¸å†ä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒiOSåˆ™ä»æ¥éƒ½æ²¡æœ‰æ”¯æŒåƒåœ¾å›æ”¶æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“&lt;code&gt;create&lt;/code&gt;æˆ–è€…&lt;code&gt;copy&lt;/code&gt;å¯¹è±¡æ—¶ï¼Œä¼šè®¡æ•°ä¸º1ï¼Œå…¶ä»–å¯¹è±¡éœ€è¦&lt;code&gt;retain&lt;/code&gt;æ—¶ï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚æŒæœ‰å¯¹è±¡çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥æ”¾å¼ƒæ‰€æœ‰æƒï¼Œæ”¾å¼ƒæ‰€æœ‰æƒæ—¶å‡å°‘è®¡æ•°ï¼Œå½“è®¡æ•°ä¸º0æ—¶å°±ä¼šé‡Šæ”¾å¯¹è±¡ã€‚&lt;br&gt;å¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ojaltanzc.bkt.clouddn.com/2016-12-29-memory-management/memory_management_2x.png&quot; alt=&quot;memory_management&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://github.com/VeinGuo/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>NSNotificationCenterå®ç°åŸç†ï¼Ÿ</title>
    <link href="https://github.com/VeinGuo/2016/12/21/NSNotificationCenter%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F/"/>
    <id>https://github.com/VeinGuo/2016/12/21/NSNotificationCenterå®ç°åŸç†ï¼Ÿ/</id>
    <published>2016-12-21T01:07:05.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="#å‰è¨€"></a>#å‰è¨€</h2><p>Cocoaä¸­ä½¿ç”¨NSNotificationã€NSNotificationCenterå’ŒKVOæ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ç°å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦æ¥è®¨è®ºNSNotificationå’ŒNSNotificationCenter</p>
<h2 id="NSNotification"><a href="#NSNotification" class="headerlink" title="# NSNotification"></a># NSNotification</h2><p><code>NSNotification</code>æ˜¯æ–¹ä¾¿<code>NSNotificationCenter</code>å¹¿æ’­åˆ°å…¶ä»–å¯¹è±¡æ—¶çš„å°è£…å¯¹è±¡ï¼Œç®€å•è®²å³é€šçŸ¥ä¸­å¿ƒå¯¹é€šçŸ¥è°ƒåº¦è¡¨ä¸­çš„å¯¹è±¡å¹¿æ’­æ—¶å‘é€<code>NSNotification</code>å¯¹è±¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSNotification</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>, <span class="title">NSCoding</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSNotificationName</span> name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>, <span class="keyword">retain</span>) <span class="keyword">id</span> object;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSDictionary</span> *userInfo;</div></pre></td></tr></table></figure>
<p><code>NSNotification</code>å¯¹è±¡åŒ…å«åç§°ã€objectã€å­—å…¸ä¸‰ä¸ªå±æ€§ï¼Œåç§°æ˜¯ç”¨æ¥æ ‡è¯†é€šçŸ¥çš„æ ‡è®°ï¼Œobjectæ˜¯è¦é€šçŸ¥çš„å¯¹è±¡å¯ä»¥ä¸º<code>nil</code>,å­—å…¸ç”¨æ¥å­˜å‚¨å‘é€é€šçŸ¥æ—¶é™„å¸¦çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¸º<code>nil</code>ã€‚<br><a id="more"></a></p>
<h2 id="NSNotificationCenter"><a href="#NSNotificationCenter" class="headerlink" title="# NSNotificationCenter"></a># NSNotificationCenter</h2><p><code>NSNotificationCenter</code>æ˜¯ç±»ä¼¼ä¸€ä¸ªå¹¿æ’­ä¸­å¿ƒç«™ï¼Œä½¿ç”¨<code>defaultCenter</code>æ¥è·å–åº”ç”¨ä¸­çš„é€šçŸ¥ä¸­å¿ƒï¼Œå®ƒå¯ä»¥å‘åº”ç”¨ä»»ä½•åœ°æ–¹å‘é€å’Œæ¥æ”¶é€šçŸ¥ã€‚åœ¨é€šçŸ¥ä¸­å¿ƒæ³¨å†Œè§‚å¯Ÿè€…ï¼Œå‘é€è€…ä½¿ç”¨é€šçŸ¥ä¸­å¿ƒå¹¿æ’­æ—¶ï¼Œä»¥<code>NSNotification</code>çš„<code>name</code>å’Œ<code>object</code>æ¥ç¡®å®šéœ€è¦å‘é€ç»™å“ªä¸ªè§‚å¯Ÿè€…ã€‚ä¸ºä¿è¯è§‚å¯Ÿè€…èƒ½æ¥æ”¶åˆ°é€šçŸ¥ï¼Œæ‰€ä»¥åº”å…ˆå‘é€šçŸ¥ä¸­å¿ƒæ³¨å†Œè§‚å¯Ÿè€…ï¼Œæ¥ç€å†å‘é€é€šçŸ¥è¿™æ ·æ‰èƒ½åœ¨é€šçŸ¥ä¸­å¿ƒè°ƒåº¦è¡¨ä¸­æŸ¥æ‰¾åˆ°ç›¸åº”è§‚å¯Ÿè€…è¿›è¡Œé€šçŸ¥ã€‚</p>
<h3 id="å‘é€è€…"><a href="#å‘é€è€…" class="headerlink" title="å‘é€è€…"></a>å‘é€è€…</h3><p>å‘é€é€šçŸ¥å¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å‘é€é€šçŸ¥</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)postNotification:(<span class="built_in">NSNotification</span> *)notification;</div><div class="line">- (<span class="keyword">void</span>)postNotificationName:(<span class="built_in">NSNotificationName</span>)aName object:(<span class="keyword">nullable</span> <span class="keyword">id</span>)anObject;</div><div class="line">- (<span class="keyword">void</span>)postNotificationName:(<span class="built_in">NSNotificationName</span>)aName object:(<span class="keyword">nullable</span> <span class="keyword">id</span>)anObject userInfo:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span> *)aUserInfo;</div></pre></td></tr></table></figure>
<ul>
<li><p>ä¸‰ç§æ–¹å¼å®é™…ä¸Šéƒ½æ˜¯å‘é€<code>NSNotification</code>å¯¹è±¡ç»™é€šçŸ¥ä¸­å¿ƒæ³¨å†Œçš„è§‚å¯Ÿè€…ã€‚</p>
</li>
<li><p>å‘é€é€šçŸ¥é€šè¿‡nameå’Œobjectæ¥ç¡®å®šæ¥æ ‡è¯†è§‚å¯Ÿè€…,nameå’Œobjectä¸¤ä¸ªå‚æ•°çš„è§„åˆ™ç›¸åŒå³å½“é€šçŸ¥è®¾ç½®nameä¸ºkChangeNotifitionæ—¶ï¼Œé‚£ä¹ˆåªä¼šå‘é€ç»™ç¬¦åˆnameä¸ºkChangeNotifitionçš„è§‚å¯Ÿè€…ï¼ŒåŒç†objectæŒ‡å‘é€ç»™æŸä¸ªç‰¹å®šå¯¹è±¡é€šçŸ¥ï¼Œå¦‚æœåªè®¾ç½®äº†nameï¼Œé‚£ä¹ˆåªæœ‰å¯¹åº”åç§°çš„é€šçŸ¥ä¼šè§¦å‘ã€‚å¦‚æœåŒæ—¶è®¾ç½®nameå’Œobjectå‚æ•°æ—¶å°±å¿…é¡»åŒæ—¶ç¬¦åˆè¿™ä¸¤ä¸ªæ¡ä»¶çš„è§‚å¯Ÿè€…æ‰èƒ½æ¥æ”¶åˆ°é€šçŸ¥ã€‚</p>
</li>
</ul>
<h3 id="è§‚å¯Ÿè€…"><a href="#è§‚å¯Ÿè€…" class="headerlink" title="è§‚å¯Ÿè€…"></a>è§‚å¯Ÿè€…</h3><p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ³¨å†Œè§‚å¯Ÿè€…</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)addObserver:(<span class="keyword">id</span>)observer selector:(SEL)aSelector name:(<span class="keyword">nullable</span> <span class="built_in">NSNotificationName</span>)aName object:(<span class="keyword">nullable</span> <span class="keyword">id</span>)anObject;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span> &lt;<span class="built_in">NSObject</span>&gt;)addObserverForName:(<span class="keyword">nullable</span> <span class="built_in">NSNotificationName</span>)name object:(<span class="keyword">nullable</span> <span class="keyword">id</span>)obj queue:(<span class="keyword">nullable</span> <span class="built_in">NSOperationQueue</span> *)queue usingBlock:(<span class="keyword">void</span> (^)(<span class="built_in">NSNotification</span> *note))block <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_6, <span class="number">4</span>_0);</div><div class="line">    <span class="comment">// The return value is retained by the system, and should be held onto by the caller in</span></div><div class="line">    <span class="comment">// order to remove the observer with removeObserver: later, to stop observation.</span></div></pre></td></tr></table></figure>
<ol>
<li>ç¬¬ä¸€ç§æ–¹å¼æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ·»åŠ <code>Oberver</code>çš„æ–¹å¼ï¼Œæ¥åˆ°é€šçŸ¥æ—¶æ‰§è¡ŒaSelectorã€‚</li>
<li>ç¬¬äºŒç§æ–¹å¼æ˜¯åŸºäºBlockæ¥æ·»åŠ è§‚å¯Ÿè€…ï¼Œå¾€é€šçŸ¥ä¸­å¿ƒçš„è°ƒåº¦è¡¨ä¸­æ·»åŠ è§‚å¯Ÿè€…ï¼Œè¿™ä¸ªè§‚å¯Ÿè€…åŒ…æ‹¬ä¸€ä¸ª<code>queue</code>å’Œä¸€ä¸ª<code>block</code>,å¹¶ä¸”ä¼šè¿”å›è¿™ä¸ªè§‚å¯Ÿè€…å¯¹è±¡ã€‚å½“æ¥åˆ°é€šçŸ¥æ—¶æ‰§è¡Œ<code>block</code>æ‰€åœ¨çš„çº¿ç¨‹ä¸ºæ·»åŠ è§‚å¯Ÿè€…æ—¶ä¼ å…¥çš„<code>queue</code>å‚æ•°ï¼Œ<code>queue</code>ä¹Ÿå¯ä»¥ä¸º<code>nil</code>ï¼Œé‚£ä¹ˆ<code>block</code>å°±åœ¨é€šçŸ¥æ‰€åœ¨çš„çº¿ç¨‹åŒæ­¥æ‰§è¡Œã€‚</li>
</ol>
<p><strong>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä½¿ç”¨ç¬¬äºŒç§çš„æ–¹å¼åˆ›å»ºè§‚å¯Ÿè€…éœ€è¦å¼±å¼•ç”¨å¯èƒ½å¼•èµ·å¾ªç¯å¼•ç”¨çš„å¯¹è±¡,é¿å…å†…å­˜æ³„æ¼ã€‚</strong></p>
<h3 id="ç§»é™¤è§‚å¯Ÿè€…"><a href="#ç§»é™¤è§‚å¯Ÿè€…" class="headerlink" title="ç§»é™¤è§‚å¯Ÿè€…"></a>ç§»é™¤è§‚å¯Ÿè€…</h3><p>åœ¨å¯¹è±¡è¢«é‡Šæ”¾å‰éœ€è¦ç§»é™¤æ‰è§‚å¯Ÿè€…ï¼Œé¿å…å·²ç»è¢«é‡Šæ”¾çš„å¯¹è±¡è¿˜æ¥æ”¶åˆ°é€šçŸ¥å¯¼è‡´å´©æºƒã€‚<br>ç§»é™¤è§‚å¯Ÿè€…æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="keyword">id</span>)observer;</div><div class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="keyword">id</span>)observer name:(<span class="keyword">nullable</span> <span class="built_in">NSNotificationName</span>)aName object:(<span class="keyword">nullable</span> <span class="keyword">id</span>)anObject;</div></pre></td></tr></table></figure>
<ul>
<li>ä¼ å…¥ç›¸åº”çš„éœ€è¦ç§»é™¤çš„<code>observer</code> æˆ–è€…ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ä¸‰ä¸ªå‚æ•°æ¥ç§»é™¤æŒ‡å®šæŸä¸ªè§‚å¯Ÿè€…ã€‚</li>
<li>å¦‚æœä½¿ç”¨åŸºäº<code>-[NSNotificationCenter addObserverForName:object:queue:usingBlock:]</code>æ–¹æ³•åœ¨è·å–æ–¹æ³•è¿”å›çš„è§‚å¯Ÿè€…è¿›è¡Œé‡Šæ”¾ã€‚åŸºäºè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬è¿˜å¯ä»¥è®©è§‚å¯Ÿè€…æ¥åˆ°é€šçŸ¥ååªæ‰§è¡Œä¸€æ¬¡ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">__block __<span class="keyword">weak</span> <span class="keyword">id</span>&lt;<span class="built_in">NSObject</span>&gt; observer = [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserverForName:kChangeNotifition object:<span class="literal">nil</span> queue:[<span class="built_in">NSOperationQueue</span> mainQueue] usingBlock:^(<span class="built_in">NSNotification</span> * _Nonnull note) &#123;</div><div class="line">       <span class="built_in">NSLog</span>(<span class="string">@"-[NSNotificationCenter addObserverForName:object:queue:usingBlock:]"</span>);</div><div class="line">      [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:observer];</div><div class="line">   &#125;];</div></pre></td></tr></table></figure>
<p>åœ¨<code>iOS9</code>ä¸­è°ƒæ•´äº†<code>NSNotificatinonCenter</code><br><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-21-Notification/NSNotificationCenter.png" alt="NSNotification"><br><code>iOS9</code>å¼€å§‹ä¸éœ€è¦åœ¨è§‚å¯Ÿè€…å¯¹è±¡é‡Šæ”¾ä¹‹å‰ä»é€šçŸ¥ä¸­å¿ƒç§»é™¤è§‚å¯Ÿè€…äº†ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨<code>-[NSNotificationCenter addObserverForName:object:queue:usingBlock:]</code>æ–¹æ³•è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚å› ä¸º<code>NSNotificationCenter</code>ä¾æ—§å¯¹å®ƒä»¬å¼ºå¼•ç”¨ã€‚</p>
<h2 id="NSNotificationQueue"><a href="#NSNotificationQueue" class="headerlink" title="# NSNotificationQueue"></a># NSNotificationQueue</h2><p><code>NSNotificationQueue</code>é€šçŸ¥é˜Ÿåˆ—ï¼Œç”¨æ¥ç®¡ç†å¤šä¸ªé€šçŸ¥çš„è°ƒç”¨ã€‚é€šçŸ¥é˜Ÿåˆ—é€šå¸¸ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é¡ºåºç»´æŠ¤é€šã€‚<code>NSNotificationQueue</code>å°±åƒä¸€ä¸ªç¼“å†²æ± æŠŠä¸€ä¸ªä¸ªé€šçŸ¥æ”¾è¿›æ± å­ä¸­ï¼Œä½¿ç”¨ç‰¹å®šæ–¹å¼é€šè¿‡<code>NSNotificationCenter</code>å‘é€åˆ°ç›¸åº”çš„è§‚å¯Ÿè€…ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šæåˆ°ç‰¹å®šçš„æ–¹å¼å³åˆå¹¶é€šçŸ¥å’Œå¼‚æ­¥é€šçŸ¥ã€‚</p>
<ul>
<li>åˆ›å»ºé€šçŸ¥é˜Ÿåˆ—æ–¹æ³•:</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithNotificationCenter:(<span class="built_in">NSNotificationCenter</span> *)notificationCenter <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</div></pre></td></tr></table></figure>
<ul>
<li>å¾€é˜Ÿåˆ—åŠ å…¥é€šçŸ¥æ–¹æ³•:</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)enqueueNotification:(<span class="built_in">NSNotification</span> *)notification postingStyle:(<span class="built_in">NSPostingStyle</span>)postingStyle;</div><div class="line">- (<span class="keyword">void</span>)enqueueNotification:(<span class="built_in">NSNotification</span> *)notification postingStyle:(<span class="built_in">NSPostingStyle</span>)postingStyle coalesceMask:(<span class="built_in">NSNotificationCoalescing</span>)coalesceMask forModes:(<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="built_in">NSRunLoopMode</span>&gt; *)modes;</div></pre></td></tr></table></figure>
<ul>
<li>ç§»é™¤é˜Ÿåˆ—ä¸­çš„é€šçŸ¥æ–¹æ³•:</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)dequeueNotificationsMatching:(<span class="built_in">NSNotification</span> *)notification coalesceMask:(<span class="built_in">NSUInteger</span>)coalesceMask;</div></pre></td></tr></table></figure>
<h3 id="å‘é€æ–¹å¼"><a href="#å‘é€æ–¹å¼" class="headerlink" title="å‘é€æ–¹å¼"></a>å‘é€æ–¹å¼</h3><ul>
<li><code>NSPostingStyle</code>åŒ…æ‹¬ä¸‰ç§ç±»å‹ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">NSPostingStyle</span>) &#123;</div><div class="line">    <span class="built_in">NSPostWhenIdle</span> = <span class="number">1</span>,</div><div class="line">    <span class="built_in">NSPostASAP</span> = <span class="number">2</span>,</div><div class="line">    <span class="built_in">NSPostNow</span> = <span class="number">3</span>	 </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>NSPostWhenIdle</strong>ï¼šç©ºé—²å‘é€é€šçŸ¥ å½“è¿è¡Œå¾ªç¯å¤„äºç­‰å¾…æˆ–ç©ºé—²çŠ¶æ€æ—¶ï¼Œå‘é€é€šçŸ¥ï¼Œå¯¹äºä¸é‡è¦çš„é€šçŸ¥å¯ä»¥ä½¿ç”¨ã€‚<br><strong>NSPostASAP</strong>ï¼šå°½å¿«å‘é€é€šçŸ¥ å½“å‰è¿è¡Œå¾ªç¯è¿­ä»£å®Œæˆæ—¶ï¼Œé€šçŸ¥å°†ä¼šè¢«å‘é€ï¼Œæœ‰ç‚¹ç±»ä¼¼æ²¡æœ‰å»¶è¿Ÿçš„å®šæ—¶å™¨ã€‚<br><strong>NSPostNow</strong> ï¼šåŒæ­¥å‘é€é€šçŸ¥ å¦‚æœä¸ä½¿ç”¨åˆå¹¶é€šçŸ¥ å’Œ<code>postNotification:</code>ä¸€æ ·æ˜¯åŒæ­¥é€šçŸ¥ã€‚</p>
<h3 id="åˆå¹¶é€šçŸ¥"><a href="#åˆå¹¶é€šçŸ¥" class="headerlink" title="åˆå¹¶é€šçŸ¥"></a>åˆå¹¶é€šçŸ¥</h3><ul>
<li><code>NSNotificationCoalescing</code>ä¹ŸåŒ…æ‹¬ä¸‰ç§ç±»å‹ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">NSNotificationCoalescing</span>) &#123;</div><div class="line">    <span class="built_in">NSNotificationNoCoalescing</span> = <span class="number">0</span>,</div><div class="line">    <span class="built_in">NSNotificationCoalescingOnName</span> = <span class="number">1</span>,</div><div class="line">    <span class="built_in">NSNotificationCoalescingOnSender</span> = <span class="number">2</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>NSNotificationNoCoalescing</strong>ï¼šä¸åˆå¹¶é€šçŸ¥ã€‚<br><strong>NSNotificationCoalescingOnName</strong>ï¼šåˆå¹¶ç›¸åŒåç§°çš„é€šçŸ¥ã€‚<br><strong>NSNotificationCoalescingOnSender</strong>ï¼šåˆå¹¶ç›¸åŒé€šçŸ¥å’ŒåŒä¸€å¯¹è±¡çš„é€šçŸ¥ã€‚</p>
<ul>
<li>é€šè¿‡åˆå¹¶æˆ‘ä»¬å¯ä»¥ç”¨æ¥ä¿è¯ç›¸åŒçš„é€šçŸ¥åªè¢«å‘é€ä¸€æ¬¡ã€‚</li>
<li><code>forModes:(nullable NSArray&lt;NSRunLoopMode&gt; *)modes</code>å¯ä»¥ä½¿ç”¨ä¸åŒçš„<code>NSRunLoopMode</code>é…åˆæ¥å‘é€é€šçŸ¥ï¼Œå¯ä»¥çœ‹å‡ºå®é™…ä¸Š<code>NSNotificationQueue</code>ä¸<code>RunLoop</code>çš„æœºåˆ¶ä»¥åŠè¿è¡Œå¾ªç¯æœ‰å…³ç³»ï¼Œé€šè¿‡<code>NSNotificationQueue</code>é˜Ÿåˆ—æ¥å‘é€çš„é€šçŸ¥å’Œå…³è”çš„<code>RunLoop</code>è¿è¡Œæœºåˆ¶æ¥è¿›è¡Œçš„ã€‚</li>
</ul>
<h2 id="NSNotificatinonCenterå®ç°åŸç†"><a href="#NSNotificatinonCenterå®ç°åŸç†" class="headerlink" title="# NSNotificatinonCenterå®ç°åŸç†"></a># NSNotificatinonCenterå®ç°åŸç†</h2><ul>
<li><code>NSNotificatinonCenter</code>æ˜¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°çš„ç”¨äºè·¨å±‚ä¼ é€’æ¶ˆæ¯ï¼Œç”¨æ¥é™ä½è€¦åˆåº¦ã€‚</li>
<li><code>NSNotificatinonCenter</code>ç”¨æ¥ç®¡ç†é€šçŸ¥ï¼Œå°†è§‚å¯Ÿè€…æ³¨å†Œåˆ°<code>NSNotificatinonCenter</code>çš„é€šçŸ¥è°ƒåº¦è¡¨ä¸­ï¼Œç„¶åå‘é€é€šçŸ¥æ—¶åˆ©ç”¨æ ‡è¯†ç¬¦<code>name</code>å’Œ<code>object</code>è¯†åˆ«å‡ºè°ƒåº¦è¡¨ä¸­çš„è§‚å¯Ÿè€…ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼Œå³ä¼ é€’æ¶ˆæ¯ï¼ˆåœ¨Objective-Cä¸­å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œå°±æ˜¯ä¼ é€’æ¶ˆæ¯ï¼Œæ¶ˆæ¯æœ‰nameæˆ–è€…selectorï¼Œå¯ä»¥æ¥å—å‚æ•°ï¼Œè€Œä¸”å¯èƒ½æœ‰è¿”å›å€¼ï¼‰ï¼Œå¦‚æœæ˜¯åŸºäº<code>block</code>åˆ›å»ºçš„é€šçŸ¥å°±è°ƒç”¨<code>NSNotification</code>çš„<code>block</code>ã€‚</li>
</ul>
<p>### å‚è€ƒèµ„æ–™</p>
<ul>
<li><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Notifications/Introduction/introNotifications.html#//apple_ref/doc/uid/10000043-SW1" target="_blank" rel="external">Notification Programming Topics</a></li>
<li><a href="http://www.hpique.com/2013/12/nsnotificationcenter-part-4/" target="_blank" rel="external">NSNotificationCenter part 4: Asynchronous notifications with NSNotificationQueue</a></li>
<li><a href="http://nshipster.com/nsnotification-and-nsnotificationcenter/" target="_blank" rel="external">NSNotification &amp; NSNotification Center</a></li>
</ul>
<p>&lt;!â€” more â€“&gt;</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;#å‰è¨€&quot;&gt;&lt;/a&gt;#å‰è¨€&lt;/h2&gt;&lt;p&gt;Cocoaä¸­ä½¿ç”¨NSNotificationã€NSNotificationCenterå’ŒKVOæ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ç°å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦æ¥è®¨è®ºNSNotificationå’ŒNSNotificationCenter&lt;/p&gt;
&lt;h2 id=&quot;NSNotification&quot;&gt;&lt;a href=&quot;#NSNotification&quot; class=&quot;headerlink&quot; title=&quot;# NSNotification&quot;&gt;&lt;/a&gt;# NSNotification&lt;/h2&gt;&lt;p&gt;&lt;code&gt;NSNotification&lt;/code&gt;æ˜¯æ–¹ä¾¿&lt;code&gt;NSNotificationCenter&lt;/code&gt;å¹¿æ’­åˆ°å…¶ä»–å¯¹è±¡æ—¶çš„å°è£…å¯¹è±¡ï¼Œç®€å•è®²å³é€šçŸ¥ä¸­å¿ƒå¯¹é€šçŸ¥è°ƒåº¦è¡¨ä¸­çš„å¯¹è±¡å¹¿æ’­æ—¶å‘é€&lt;code&gt;NSNotification&lt;/code&gt;å¯¹è±¡ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;NSNotification&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt; &amp;lt;&lt;span class=&quot;title&quot;&gt;NSCopying&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;NSCoding&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSNotificationName&lt;/span&gt; name;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;retain&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;readonly&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *userInfo;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;NSNotification&lt;/code&gt;å¯¹è±¡åŒ…å«åç§°ã€objectã€å­—å…¸ä¸‰ä¸ªå±æ€§ï¼Œåç§°æ˜¯ç”¨æ¥æ ‡è¯†é€šçŸ¥çš„æ ‡è®°ï¼Œobjectæ˜¯è¦é€šçŸ¥çš„å¯¹è±¡å¯ä»¥ä¸º&lt;code&gt;nil&lt;/code&gt;,å­—å…¸ç”¨æ¥å­˜å‚¨å‘é€é€šçŸ¥æ—¶é™„å¸¦çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¸º&lt;code&gt;nil&lt;/code&gt;ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://github.com/VeinGuo/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>autoreleasepoolæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</title>
    <link href="https://github.com/VeinGuo/2016/12/13/autoreleasepool%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F/"/>
    <id>https://github.com/VeinGuo/2016/12/13/autoreleasepoolæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ/</id>
    <published>2016-12-12T17:30:00.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>è™½ç„¶åœ¨ARCæ—¶ä»£æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¸çŸ¥é“<code>Autorelease</code>å°±èƒ½ç®¡ç†å¥½å†…å­˜ï¼Œä½†åœ¨äº†è§£<code>objc</code>å†…å­˜ç®¡ç†è¿˜æ˜¯ååˆ†é‡è¦çš„ï¼Œåœ¨é˜…è¯»äº†ä¹¦ç±å’Œä¸€äº›å¹²è´§å¹¶åŠ¨æ‰‹éªŒè¯ä¹‹åï¼Œå†³å®šæ€»ç»“<code>autoreleasePool</code>çš„å®ç°ã€‚</p>
<hr>
<h2 id="ä»€ä¹ˆæ˜¯autorelease"><a href="#ä»€ä¹ˆæ˜¯autorelease" class="headerlink" title="ä»€ä¹ˆæ˜¯autorelease"></a>ä»€ä¹ˆæ˜¯autorelease</h2><p><code>autoreleasePool</code>å¦‚ä½•å®ç°éœ€è¦å…ˆçŸ¥é“ä»€ä¹ˆæ˜¯<code>autorelease</code>ï¼Ÿ</p>
<p><code>autorelease</code>ç±»ä¼¼äºCè¯­è¨€ä¸­<a href="https://en.wikipedia.org/wiki/Automatic_variable" target="_blank" rel="external">Automatic variable</a>è‡ªåŠ¨å˜é‡ï¼Œç¨‹åºæ‰§è¡Œæ—¶ï¼Œè‹¥æŸè‡ªåŠ¨å˜é‡è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œè¯¥è‡ªåŠ¨å˜é‡å°†è¢«è‡ªåŠ¨åºŸå¼ƒã€‚</p>
<h2 id="autoreleaseä½•æ—¶é‡Šæ”¾"><a href="#autoreleaseä½•æ—¶é‡Šæ”¾" class="headerlink" title="autoreleaseä½•æ—¶é‡Šæ”¾"></a>autoreleaseä½•æ—¶é‡Šæ”¾</h2><p>é¢è¯•æ—¶æé—®<code>objc</code>å†…å­˜ç®¡ç†åŸºæœ¬éƒ½ä¼šé—®åˆ°<code>autorelease</code>ä½•æ—¶é‡Šæ”¾,åœ¨æ²¡æœ‰ä½¿ç”¨<code>@autoreleasepool</code>çš„æƒ…å†µ,<code>autorelease</code>å¯¹è±¡æ˜¯åœ¨å½“å‰çš„<code>runloop</code>è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ã€‚</p>
<p>æ¯ä¸ªrunloopä¸­éƒ½ä¼šåˆ›å»ºä¸€ä¸ª <code>autoreleasepool</code> å¹¶åœ¨runloopè¿­ä»£ç»“æŸè¿›è¡Œé‡Šæ”¾ã€‚</p>
<p>å¦‚æœæ˜¯æ‰‹åŠ¨åˆ›å»º<code>autoreleasepool</code>,è‡ªå·±åˆ›å»ºPoolå¹¶é‡Šæ”¾ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MRC</span></div><div class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [<span class="built_in">NSAutoreleasePool</span> alloc] init];</div><div class="line"></div><div class="line"><span class="keyword">id</span> obj = [<span class="built_in">NSObject</span> alloc] init];</div><div class="line">[obj autorelease];</div><div class="line">[pool drain];</div><div class="line"></div><div class="line"><span class="comment">// ARC</span></div><div class="line"><span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">		<span class="keyword">id</span> obj = [<span class="built_in">NSObject</span> alloc] init];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><code>Apple</code>æ–‡æ¡£ä¸­æåˆ°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@autoreleasepool blocks are more efficient than using an instance of NSAutoreleasePool directly; you can also use them even if you do not use ARC.</div></pre></td></tr></table></figure></p>
<p>ä¸ç®¡æ˜¯<code>MRC</code>è¿˜æ˜¯<code>ARC</code>æœ€å¥½ä½¿ç”¨@autoreleasepool blocksã€‚<br><a id="more"></a></p>
<h2 id="autoreleasepool"><a href="#autoreleasepool" class="headerlink" title="@autoreleasepool"></a>@autoreleasepool</h2><p>ä¸Šé¢æåˆ°çš„ä½¿ç”¨<code>@autoreleasepool</code>æ¥æ‰‹åŠ¨åˆ›å»ºå¹¶é‡Šæ”¾<code>autorelease</code><br><code>@autoreleasepool</code> ä½¿ç”¨<code>clang</code>ç¼–è¯‘ä¹‹å</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/* @autoreleasepool */</span> </div><div class="line">&#123; </div><div class="line">	__AtAutoreleasePool __autoreleasepool; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>@autoreleasepool</code>è¢«è½¬è½¬æ¢æˆ<code>__AtAutoreleasePool</code> ç»“æ„ä½“ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> __AtAutoreleasePool </div><div class="line">&#123;</div><div class="line">  __AtAutoreleasePool() </div><div class="line">  &#123;</div><div class="line">		atautoreleasepoolobj = objc_autoreleasePoolPush();</div><div class="line">  &#125;</div><div class="line">  ~__AtAutoreleasePool() </div><div class="line">  &#123;</div><div class="line">  		objc_autoreleasePoolPop(atautoreleasepoolobj);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">void</span> * atautoreleasepoolobj;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° <code>__AtAutoreleasePool()</code> æ„é€ å‡½æ•°è°ƒç”¨<code>objc_autoreleasePoolPush()</code>,<code>~__AtAutoreleasePool()</code> ææ„å‡½æ•°è°ƒç”¨ <code>objc_autoreleasePoolPop()</code></p>
<p>åœ¨ <code>MRC</code> ä¸­æˆ‘ä»¬ä½¿ç”¨ <code>NSAutoreleasePool</code> æ¥åˆ›å»ºAutoreleasePool,é‚£ä¹ˆç›¸åº”çš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSAutoreleasePool</span> *pool = [<span class="built_in">NSAutoreleasePool</span> alloc] init];</div><div class="line"><span class="comment">// ç›¸å½“äºè°ƒç”¨æ„é€ å‡½æ•°ä¹Ÿå°±æ˜¯ objc_autoreleasePoolPush();</span></div><div class="line">[pool drain];</div><div class="line"><span class="comment">// ç›¸å½“äºè°ƒç”¨ææ„å‡½æ•°ä¹Ÿå°±æ˜¯ objc_autoreleasePoolPop(pool);</span></div></pre></td></tr></table></figure>
<p><code>objc_autoreleasePoolPush</code> å’Œ <code>objc_autoreleasePoolPop</code> æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><code>objc_autoreleasePoolPush</code> å’Œ <code>objc_autoreleasePoolPop</code> å®ç°éœ€è¦ä»<a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="external">runtime</a>æºä»£ç çœ‹åˆ°,æ–‡ä¸­çš„ä»£ç çš„æ˜¯æœ€æ–°çš„<code>objc4-706.tar.gz</code></p>
<p>åœ¨ <code>NSObject.mm</code> æ–‡ä»¶ä¸­ï¼š<br><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/2.png" alt="NSObject.mm"></p>
<p>å®é™…ä¸Šæ˜¯è°ƒç”¨<code>AutoreleasePoolPage</code>çš„<code>push</code>å’Œ<code>pop</code>ä¸¤ä¸ªç±»æ–¹æ³•</p>
<h3 id="AutoreleasePoolPage"><a href="#AutoreleasePoolPage" class="headerlink" title="AutoreleasePoolPage"></a>AutoreleasePoolPage</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹<code>AutoreleasePoolPage</code>è¿™ä¸ªç±»</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> EMPTY_POOL_PLACEHOLDER ((id*)1)</span></div><div class="line"></div><div class="line"><span class="meta">#   <span class="meta-keyword">define</span> POOL_BOUNDARY nil</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">pthread_key_t</span> <span class="keyword">const</span> key = AUTORELEASE_POOL_KEY;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">uint8_t</span> <span class="keyword">const</span> SCRIBBLE = <span class="number">0xA3</span>;  <span class="comment">// 0xA3A3A3A3 after releasing</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">size_t</span> <span class="keyword">const</span> SIZE = </div><div class="line">#<span class="keyword">if</span> PROTECT_AUTORELEASEPOOL</div><div class="line">        PAGE_MAX_SIZE;  <span class="comment">// must be multiple of vm page size</span></div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">        PAGE_MAX_SIZE;  <span class="comment">// size and alignment, power of 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">size_t</span> <span class="keyword">const</span> COUNT = SIZE / <span class="keyword">sizeof</span>(id);</div><div class="line"></div><div class="line">    <span class="keyword">magic_t</span> <span class="keyword">const</span> magic;</div><div class="line">    id *next;</div><div class="line">    <span class="keyword">pthread_t</span> <span class="keyword">const</span> thread;</div><div class="line">    AutoreleasePoolPage * <span class="keyword">const</span> parent;</div><div class="line">    AutoreleasePoolPage *child;</div><div class="line">    <span class="keyword">uint32_t</span> <span class="keyword">const</span> depth;</div><div class="line">    <span class="keyword">uint32_t</span> hiwat;</div></pre></td></tr></table></figure>
<p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/AutoreleasePoolPage.png" alt="AutoreleasePoolPage"></p>
<ul>
<li><code>magic</code> æ£€æŸ¥æ ¡éªŒå®Œæ•´æ€§çš„å˜é‡</li>
<li><code>next</code>  æŒ‡å‘æ–°åŠ å…¥çš„autreleaseå¯¹è±¡ä¸‹ä¸€ä¸ªä½ç½®å¦‚ä¸‹å›¾ï¼š</li>
</ul>
<p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/next.png" alt="next"></p>
<ul>
<li><code>thread</code> pageå½“å‰æ‰€åœ¨çš„çº¿ç¨‹</li>
<li><code>parent</code>    çˆ¶èŠ‚ç‚¹ æŒ‡å‘å‰ä¸€ä¸ªpage</li>
<li><code>child</code>    å­èŠ‚ç‚¹ æŒ‡å‘ä¸‹ä¸€ä¸ªpage</li>
<li><code>depth</code> é“¾è¡¨çš„æ·±åº¦ï¼ŒèŠ‚ç‚¹ä¸ªæ•°</li>
<li><p><code>hiwat</code> high water mark æ•°æ®å®¹çº³çš„ä¸€ä¸ªä¸Šé™</p>
</li>
<li><p><code>EMPTY_POOL_PLACEHOLDER</code> ç©ºæ± å ä½</p>
</li>
<li><p><code>POOL_BOUNDARY</code> æ˜¯ä¸€ä¸ªè¾¹ç•Œå¯¹è±¡ <code>nil</code>,ä¹‹å‰çš„æºä»£ç å˜é‡åæ˜¯ <code>POOL_SENTINEL</code>å“¨å…µå¯¹è±¡,ç”¨æ¥åŒºåˆ«æ¯ä¸ª<code>page</code>å³æ¯ä¸ª <code>AutoreleasePoolPage</code> è¾¹ç•Œ</p>
</li>
<li><p><code>PAGE_MAX_SIZE</code> å®šä¹‰çš„å¤§å°åœ¨ä¸‹å›¾å¯ä»¥çœ‹åˆ°:</p>
</li>
</ul>
<p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/PAGE_MAX_SIZE.png" alt="PAGE_MAX_SIZE"></p>
<ul>
<li><code>PAGE_MAX_SIZE</code> = 4096, ä¸ºä»€ä¹ˆæ˜¯4096å‘¢ï¼Ÿå…¶å®å°±æ˜¯è™šæ‹Ÿå†…å­˜æ¯ä¸ªæ‰‡åŒº4096ä¸ªå­—èŠ‚,<a href="https://zh.wikipedia.org/zh-hans/4K%E5%AF%B9%E9%BD%90" target="_blank" rel="external">4Kå¯¹é½</a>çš„è¯´æ³•ã€‚</li>
<li><code>COUNT</code> ä¸€ä¸ª<code>page</code>é‡Œå¯¹è±¡æ•°</li>
</ul>
<p><strong>åœ¨è‡ªåŠ¨é‡Šæ”¾æ± ä¸­æ¯ä¸€ä¸ª<code>AutoreleasePoolPage</code>éƒ½æ˜¯ä»¥åŒé“¾è¡¨çš„å½¢å¼è¿æ¥èµ·æ¥çš„ï¼š</strong></p>
<p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/Pool.png" alt="Pool"></p>
<p><strong><code>parent</code> æŒ‡å‘å‰ä¸€ä¸ª <code>page</code> , <code>child</code> æŒ‡å‘ä¸‹ä¸€ä¸ª <code>page</code></strong></p>
<h2 id="push"><a href="#push" class="headerlink" title="push"></a>push</h2><p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/push.png" alt="PUSH"><br>æ¯å½“è‡ªåŠ¨é‡Šæ”¾æ± è°ƒç”¨<code>objc_autoreleasePoolPush</code>æ—¶éƒ½ä¼šæŠŠè¾¹ç•Œå¯¹è±¡æ”¾è¿›æ ˆé¡¶,ç„¶åè¿”å›è¾¹ç•Œå¯¹è±¡,ç”¨äºé‡Šæ”¾ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">atautoreleasepoolobj = objc_autoreleasePoolPush();</div></pre></td></tr></table></figure></p>
<p><code>atautoreleasepoolobj</code> å°±æ˜¯è¿”å›çš„è¾¹ç•Œå¯¹è±¡</p>
<p><code>push</code>å°±æ˜¯å‹æ ˆçš„æ“ä½œ,å…ˆåŠ å…¥è¾¹ç•Œå¯¹è±¡ç„¶åæ·»åŠ Aå¯¹è±¡åœ¨è¾¹ç•Œå¯¹è±¡ä¹‹å,ä¸‹ä¸€ä¸ªBå¯¹è±¡å‹å…¥Aå¯¹è±¡ä¹‹å,å°±åƒç¾½æ¯›çƒç­’æ”¾ç¾½æ¯›çƒä¸€æ ·</p>
<h2 id="pop"><a href="#pop" class="headerlink" title="pop"></a>pop</h2><p><img src="http://ojaltanzc.bkt.clouddn.com/2016-12-13-aotureleasepool/pop.png" alt="POP"><br>è‡ªåŠ¨é‡Šæ”¾æ± é‡Šæ”¾æ˜¯ä¼ å…¥ <code>push</code> è¿”å›çš„è¾¹ç•Œå¯¹è±¡,</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">objc_autoreleasePoolPop(atautoreleasepoolobj);</div></pre></td></tr></table></figure>
<p>ç„¶åå°†è¾¹ç•Œå¯¹è±¡æŒ‡å‘çš„è¿™ä¸€é¡µ <code>AutoreleasePoolPage</code> å†…çš„å¯¹è±¡é‡Šæ”¾</p>
<h2 id="End"><a href="#End" class="headerlink" title="@End"></a>@End</h2><p> <strong>æ€»ç»“ï¼š</strong></p>
<ol>
<li>è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä¸€ä¸ªä¸ª <code>AutoreleasePoolPage</code> ç»„æˆçš„ä¸€ä¸ª<code>page</code>æ˜¯4096å­—èŠ‚å¤§å°,æ¯ä¸ª <code>AutoreleasePoolPage</code> ä»¥åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± </li>
<li><code>pop</code> æ—¶æ˜¯ä¼ å…¥è¾¹ç•Œå¯¹è±¡,ç„¶åå¯¹<code>page</code> ä¸­çš„å¯¹è±¡å‘é€<code>release</code> çš„æ¶ˆæ¯</li>
</ol>
<p>æ–‡ç« æœ‰ä»€ä¹ˆç†è§£ä¸æ˜¯å¾ˆåˆ°ä½çš„å¸Œæœ›æŒ‡å‡º</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://book.douban.com/subject/24720270/" target="_blank" rel="external">ã€Šobjcé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹</a></li>
<li><a href="http://draveness.me/autoreleasepool/" target="_blank" rel="external">è‡ªåŠ¨é‡Šæ”¾æ± çš„å‰ä¸–ä»Šç”Ÿ â€”- æ·±å…¥è§£æ autoreleasepool</a></li>
<li><a href="https://developer.apple.com/reference/foundation/nsautoreleasepool#//apple_ref/occ/cl/NSAutoreleasePool" target="_blank" rel="external">NSAutoreleasePool</a></li>
<li><a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="external">é»‘å¹•èƒŒåçš„Autorelease</a></li>
</ul>
<p>&lt;!â€” more â€“&gt;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è™½ç„¶åœ¨ARCæ—¶ä»£æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¸çŸ¥é“&lt;code&gt;Autorelease&lt;/code&gt;å°±èƒ½ç®¡ç†å¥½å†…å­˜ï¼Œä½†åœ¨äº†è§£&lt;code&gt;objc&lt;/code&gt;å†…å­˜ç®¡ç†è¿˜æ˜¯ååˆ†é‡è¦çš„ï¼Œåœ¨é˜…è¯»äº†ä¹¦ç±å’Œä¸€äº›å¹²è´§å¹¶åŠ¨æ‰‹éªŒè¯ä¹‹åï¼Œå†³å®šæ€»ç»“&lt;code&gt;autoreleasePool&lt;/code&gt;çš„å®ç°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯autorelease&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯autorelease&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯autorelease&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯autorelease&lt;/h2&gt;&lt;p&gt;&lt;code&gt;autoreleasePool&lt;/code&gt;å¦‚ä½•å®ç°éœ€è¦å…ˆçŸ¥é“ä»€ä¹ˆæ˜¯&lt;code&gt;autorelease&lt;/code&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;code&gt;autorelease&lt;/code&gt;ç±»ä¼¼äºCè¯­è¨€ä¸­&lt;a href=&quot;https://en.wikipedia.org/wiki/Automatic_variable&quot;&gt;Automatic variable&lt;/a&gt;è‡ªåŠ¨å˜é‡ï¼Œç¨‹åºæ‰§è¡Œæ—¶ï¼Œè‹¥æŸè‡ªåŠ¨å˜é‡è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œè¯¥è‡ªåŠ¨å˜é‡å°†è¢«è‡ªåŠ¨åºŸå¼ƒã€‚&lt;/p&gt;
&lt;h2 id=&quot;autoreleaseä½•æ—¶é‡Šæ”¾&quot;&gt;&lt;a href=&quot;#autoreleaseä½•æ—¶é‡Šæ”¾&quot; class=&quot;headerlink&quot; title=&quot;autoreleaseä½•æ—¶é‡Šæ”¾&quot;&gt;&lt;/a&gt;autoreleaseä½•æ—¶é‡Šæ”¾&lt;/h2&gt;&lt;p&gt;é¢è¯•æ—¶æé—®&lt;code&gt;objc&lt;/code&gt;å†…å­˜ç®¡ç†åŸºæœ¬éƒ½ä¼šé—®åˆ°&lt;code&gt;autorelease&lt;/code&gt;ä½•æ—¶é‡Šæ”¾,åœ¨æ²¡æœ‰ä½¿ç”¨&lt;code&gt;@autoreleasepool&lt;/code&gt;çš„æƒ…å†µ,&lt;code&gt;autorelease&lt;/code&gt;å¯¹è±¡æ˜¯åœ¨å½“å‰çš„&lt;code&gt;runloop&lt;/code&gt;è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªrunloopä¸­éƒ½ä¼šåˆ›å»ºä¸€ä¸ª &lt;code&gt;autoreleasepool&lt;/code&gt; å¹¶åœ¨runloopè¿­ä»£ç»“æŸè¿›è¡Œé‡Šæ”¾ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯æ‰‹åŠ¨åˆ›å»º&lt;code&gt;autoreleasepool&lt;/code&gt;,è‡ªå·±åˆ›å»ºPoolå¹¶é‡Šæ”¾ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight objc&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// MRC&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSAutoreleasePool&lt;/span&gt; *pool = [&lt;span class=&quot;built_in&quot;&gt;NSAutoreleasePool&lt;/span&gt; alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj = [&lt;span class=&quot;built_in&quot;&gt;NSObject&lt;/span&gt; alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[obj autorelease];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[pool drain];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ARC&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@autoreleasepool&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; obj = [&lt;span class=&quot;built_in&quot;&gt;NSObject&lt;/span&gt; alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;Apple&lt;/code&gt;æ–‡æ¡£ä¸­æåˆ°ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;@autoreleasepool blocks are more efficient than using an instance of NSAutoreleasePool directly; you can also use them even if you do not use ARC.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸ç®¡æ˜¯&lt;code&gt;MRC&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;ARC&lt;/code&gt;æœ€å¥½ä½¿ç”¨@autoreleasepool blocksã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="objc" scheme="https://github.com/VeinGuo/tags/objc/"/>
    
  </entry>
  
  <entry>
    <title>Learn Swift</title>
    <link href="https://github.com/VeinGuo/2016/12/10/Learn%20Swift/"/>
    <id>https://github.com/VeinGuo/2016/12/10/Learn Swift/</id>
    <published>2016-12-10T00:30:00.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç§»åŠ¨"><a href="#ç§»åŠ¨" class="headerlink" title="ç§»åŠ¨"></a>ç§»åŠ¨</h2><p>å­¦ä¹ Swiftçš„ç¬”è®°å°†æ”¾åœ¨ <code>github</code> ä¸Š<br>åœ°å€ï¼šğŸ‘‡</p>
<ul>
<li><a href="https://github.com/VeinGuo/StudySwift/wiki">Swift Note</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç§»åŠ¨&quot;&gt;&lt;a href=&quot;#ç§»åŠ¨&quot; class=&quot;headerlink&quot; title=&quot;ç§»åŠ¨&quot;&gt;&lt;/a&gt;ç§»åŠ¨&lt;/h2&gt;&lt;p&gt;å­¦ä¹ Swiftçš„ç¬”è®°å°†æ”¾åœ¨ &lt;code&gt;github&lt;/code&gt; ä¸Š&lt;br&gt;åœ°å€ï¼šğŸ‘‡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
    
      <category term="Learn Swift" scheme="https://github.com/VeinGuo/tags/Learn-Swift/"/>
    
  </entry>
  
  <entry>
    <title>Blockæ˜¯å¦‚ä½•å®ç°ï¼Ÿ</title>
    <link href="https://github.com/VeinGuo/2016/12/07/Block%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F/"/>
    <id>https://github.com/VeinGuo/2016/12/07/Blockæ˜¯å¦‚ä½•å®ç°ï¼Ÿ/</id>
    <published>2016-12-07T00:50:00.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ–‡ç« æ˜¯é˜…è¯»<a href="https://book.douban.com/subject/24720270/" target="_blank" rel="external">ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹</a>ä¹‹åçš„ä¸€äº›ç†è§£æ€»ç»“ã€‚</p>
<hr>
<p>ç†è§£Blockå¦‚ä½•å®ç°,éœ€è¦äº†è§£</p>
<ul>
<li>ä»€ä¹ˆæ˜¯<code>Block</code>?</li>
<li><code>Block</code>çš„è¯­æ³•</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯Block"><a href="#ä»€ä¹ˆæ˜¯Block" class="headerlink" title="ä»€ä¹ˆæ˜¯Block"></a>ä»€ä¹ˆæ˜¯Block</h2><p><code>Block</code>æ˜¯<code>C</code>è¯­è¨€çš„æ‹“å±•åŠŸèƒ½ã€‚åœ¨Appleæ–‡æ¡£ä¸­æœ‰ä¸€å¥è¯è¯´æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">In other languages and environments, a block object is sometimes also called a closure or a lambda.</div></pre></td></tr></table></figure>
<p>å…¶ä»–è¯­è¨€å’Œç¯å¢ƒï¼Œä¸€ä¸ª<code>block</code>å¯¹è±¡æœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä½œ<code>closure</code>é—­åŒ…æˆ–<code>^</code>;</p>
<p>åœ¨é˜®ä¸€å³°çš„<a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="external">å­¦ä¹ Javascripté—­åŒ…ï¼ˆClosureï¼‰</a>ä¸­è§£é‡Šäº†ä»€ä¹ˆæ˜¯é—­åŒ…ã€‚</p>
<p><strong>é—­åŒ…å°±æ˜¯èƒ½å¤Ÿè¯»å–å…¶ä»–å‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ã€‚</strong><br><a id="more"></a></p>
<h2 id="Blockçš„è¯­æ³•"><a href="#Blockçš„è¯­æ³•" class="headerlink" title="Blockçš„è¯­æ³•"></a>Blockçš„è¯­æ³•</h2><p>å£°æ˜ä¸€ä¸ª<code>Block</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSUInteger (^lengthBlock)(NSString *);</div></pre></td></tr></table></figure>
<ol>
<li><code>NSUInteger</code>æ˜¯<code>Block</code>è¿”å›çš„å€¼ç±»å‹</li>
<li><code>^lengthBlock</code>è¡¨ç¤ºå£°æ˜äº†åå­—<code>lengthBlock</code>çš„<code>Block</code></li>
<li><code>NSString *</code>è¡¨ç¤º<code>NSString</code>ç±»å‹çš„å‚æ•°</li>
</ol>
<p>åˆ›å»ºä¸€ä¸ª<code>Block</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lengthBlock = ^(<span class="built_in">NSString</span> *str) &#123;</div><div class="line">        <span class="keyword">return</span> str.length;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)lengthBlock(<span class="string">@"123"</span>)); <span class="comment">// console 3</span></div></pre></td></tr></table></figure>
<ol>
<li><code>^(NSString *str)</code>å¯¹<code>lengthBlock</code>çš„å®šä¹‰,åˆ†é…ç»™<code>lengthBlock</code>çš„å€¼</li>
<li><code>str</code>å‚æ•°åç§°</li>
<li><code>{...}</code>å¤§æ‹¬å¼§æ˜¯<code>Block</code>çš„ä¸»ä½“</li>
<li><code>return str.length</code>æ˜¯<code>lengthBlock</code>çš„è¿”å›å€¼</li>
</ol>
<p><strong><code>Block</code>å¯ä»¥ç›´æ¥ä½¿ç”¨ç›¸åŒçš„ä½œç”¨åŸŸå†…å®šä¹‰çš„å˜é‡</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *string = <span class="string">@"123"</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">NSUInteger</span> (^lengthBlock)(<span class="built_in">NSString</span> *) = ^(<span class="built_in">NSString</span> *str)&#123;</div><div class="line">        <span class="keyword">return</span> string.length + str.length;</div><div class="line">    &#125;;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)lengthBlock(<span class="string">@"456"</span>)); <span class="comment">// console 6</span></div></pre></td></tr></table></figure>
<p><strong>Blockç±»å‹å˜é‡</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)stringWithLengthBlock:(<span class="built_in">NSUInteger</span> (^)(<span class="built_in">NSString</span> *))lengthBlock&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>,lengthBlock(<span class="string">@"456"</span>)); <span class="comment">// console 6</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">[<span class="keyword">self</span> stringWithLengthBlock:^<span class="built_in">NSUInteger</span>(<span class="built_in">NSString</span> *str) &#123;</div><div class="line">        <span class="built_in">NSString</span> *string = <span class="string">@"123"</span>;</div><div class="line">        <span class="keyword">return</span> string.length + str.length;</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>typedef</code>å£°æ˜</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^Block)(<span class="built_in">NSString</span> *str);</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)stringWithLengthBlock:(Block)block&#123;</div><div class="line">    block(<span class="string">@"123"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Blockçš„å®ç°"><a href="#Blockçš„å®ç°" class="headerlink" title="Blockçš„å®ç°"></a>Blockçš„å®ç°</h2><p>ä¸¾ä¸ªğŸŒ°</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">void</span> (^block)(<span class="keyword">void</span>) = ^&#123;printf(<span class="string">"Block\n"</span>);&#125;;</div><div class="line">    block();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨clangä½¿ç”¨ç¼–è¯‘å™¨æ”¹å†™æ–‡ä»¶</p>
<blockquote>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç¼–è¯‘åçš„ä»£ç åªæ˜¯ä¸ºäº†ç†è§£Blockçš„å®ç°,å¹¶ä¸æ˜¯Blockçš„æºç </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">clang -rewrite-objc æ–‡ä»¶å</div></pre></td></tr></table></figure>
<p>ä¸‹é¢è½¬æ¢ä¾‹å­ä»£ç å<code>Block</code>çš„ç›¸å…³ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> __main_block_impl_0 &#123;</div><div class="line">  <span class="keyword">struct</span> __block_impl impl;</div><div class="line">  <span class="keyword">struct</span> __main_block_desc_0* Desc;</div><div class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, <span class="keyword">struct</span> __main_block_desc_0 *desc, <span class="keyword">int</span> flags=<span class="number">0</span>) &#123;</div><div class="line">    impl.isa = &amp;_NSConcreteStackBlock;</div><div class="line">    impl.Flags = flags;</div><div class="line">    impl.FuncPtr = fp;</div><div class="line">    Desc = desc;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_func_0(<span class="keyword">struct</span> __main_block_impl_0 *__cself) &#123;</div><div class="line"><span class="built_in">printf</span>(<span class="string">"Block\n"</span>);&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">struct</span> __main_block_desc_0 &#123;</div><div class="line">  <span class="keyword">size_t</span> reserved;</div><div class="line">  <span class="keyword">size_t</span> Block_size;</div><div class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> __main_block_impl_0)&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">void</span> (*block)(<span class="keyword">void</span>) = ((<span class="keyword">void</span> (*)</div><div class="line">   ())&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA));</div><div class="line">   </div><div class="line">    ((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ª<code>__main_block_impl_0</code>ç»“æ„ä½“åŒ…å«<code>__block_impl</code>å’Œ<code>__main_block_desc_0</code>ä¸¤ä¸ªç»“æ„ä½“</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> __block_impl &#123;</div><div class="line">  <span class="keyword">void</span> *isa;</div><div class="line">  <span class="keyword">int</span> Flags;</div><div class="line">  <span class="keyword">int</span> Reserved;</div><div class="line">  <span class="keyword">void</span> *FuncPtr;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Blockç»“æ„ä½“çš„æ„æˆ</p>
<ol>
<li><code>isa</code>æŒ‡é’ˆ,ç”¨äºæŒ‡å‘Blockçš„æŒ‡é’ˆ</li>
<li><code>Flags</code> è¡¨ç¤ºBlocké™„åŠ çš„ä¿¡æ¯</li>
<li><code>Reserved</code> ä¿ç•™å˜é‡</li>
<li><code>FuncPtr</code> å‡½æ•°æŒ‡é’ˆæŒ‡å‘Blockå®ç°çš„å‡½æ•°åœ°å€</li>
</ol>
<p>å…¶ä¸­<code>isa</code>æŒ‡å‘Blockæœ‰ä¸‰ç§ç±»å‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">isa = &amp;_NSConcreteStackBlock;</div><div class="line">isa = &amp;_NSConcreteGlobalBlock;</div><div class="line">isa = &amp;_NSConcreteMallocBlock;</div></pre></td></tr></table></figure>
<p><code>__main_block_desc_0</code>çš„æ„æˆ,ç”¨æ¥æè¿°Blockä¸€äº›ä¿¡æ¯<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">struct</span> __main_block_desc_0 &#123;</div><div class="line">  <span class="keyword">size_t</span> reserved;</div><div class="line">  <span class="keyword">size_t</span> Block_size;</div><div class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> __main_block_impl_0)&#125;;</div></pre></td></tr></table></figure></p>
<ol>
<li><code>reserved</code>    ä¿ç•™å˜é‡</li>
<li><code>Block_size</code>    Blockçš„å¤§å°</li>
</ol>
<p>ä¸‹é¢çœ‹ä¸€ä¸‹åˆå§‹åŒ–</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">impl.isa = &amp;_NSConcreteStackBlock;</div></pre></td></tr></table></figure>
<p><code>_NSConcreteStackBlock</code> ç”¨æ¥åˆå§‹åŒ–äº†<code>__block_impl</code>ç»“æ„ä½“çš„<code>isa</code>è¿™é‡Œä¸ºä»€ä¹ˆä½¿ç”¨<code>_NSConcreteStackBlock</code>æ¥åˆå§‹åŒ–,è¯´æ˜<code>Block</code>åˆ›å»ºåœ¨<code>Stack</code>ä¸Š</p>
<p>æ¥ä¸‹æ¥çœ‹ <code>int main{}</code>ä¸­çš„è°ƒç”¨</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">void</span> (*block)(<span class="keyword">void</span>) = ((<span class="keyword">void</span> (*)())&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA));   </div><div class="line">   </div><div class="line"><span class="comment">// åˆ†æˆä¸¤éƒ¨åˆ†</span></div><div class="line"></div><div class="line"><span class="comment">// ç¬¬ä¸€éƒ¨åˆ†</span></div><div class="line">&amp;__main_block_impl_0 ((<span class="keyword">void</span> *) __main_block_func_0, &amp;__main_block_desc_0_DATA)</div><div class="line"></div><div class="line"><span class="comment">// å»æ‰è½¬æ¢éƒ¨åˆ†</span></div><div class="line">__main_block_impl_0 impl = (__main_block_impl_0(__main_block_func_0,&amp;__main_block_desc_0_DATA));</div><div class="line"></div><div class="line"><span class="comment">// ç¬¬äºŒéƒ¨åˆ†</span></div><div class="line"><span class="keyword">void</span> (*block)(<span class="keyword">void</span>) =((<span class="keyword">void</span> (*)())&amp;__main_block_impl_0()</div><div class="line"><span class="comment">// å»æ‰è½¬æ¢éƒ¨åˆ†</span></div><div class="line"><span class="keyword">struct</span> __main_block_impl_0 *block = &amp;impl;  <span class="comment">// è¿™é‡ŒimplæŒ‡çš„æ˜¯ä¸Šé¢çš„ç¬¬ä¸€éƒ¨åˆ†</span></div></pre></td></tr></table></figure>
<p>å°†<code>__main_block_impl_0</code>ç»“æ„çš„<code>impl</code>å®ä¾‹åœ°å€èµ‹å€¼ç»™<code>*block</code>å‡½æ•°æŒ‡é’ˆ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block);</div><div class="line"></div><div class="line"><span class="comment">// å»æ‰è½¬æ¢éƒ¨åˆ†</span></div><div class="line">(*block -&gt;impl.FuncPtr)(block);</div></pre></td></tr></table></figure>
<p>ä»£ç ä½¿ç”¨äº†<a href="http://baike.baidu.com/link?url=2XOSKIcmha-ntPSox2Rl0mee7lMaJwatpwWzwqvOjU5DAnsEiX8rAXJBTcccpQ9U2EFLDae8YAzSrPnXLONqiiR1vIllvLPvesp-bM1oubRK2y1uFu-2ueudqZDcT1qv#2" target="_blank" rel="external">å‡½æ•°æŒ‡é’ˆ</a>è°ƒç”¨å‡½æ•°<br>å–å‡º<code>block</code>çš„å‡½æ•°æŒ‡é’ˆè°ƒç”¨<code>FuncPtr</code>,ä»¥è‡ªèº«ï¼ˆ<code>block</code>ï¼‰ä¸ºå‚æ•°ä¼ å…¥</p>
<h3 id="æ€»ç»“ä¸€ä¸‹Blockç®€å•çš„å®ç°æµç¨‹"><a href="#æ€»ç»“ä¸€ä¸‹Blockç®€å•çš„å®ç°æµç¨‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹Blockç®€å•çš„å®ç°æµç¨‹"></a><strong>æ€»ç»“ä¸€ä¸‹<code>Block</code>ç®€å•çš„å®ç°æµç¨‹</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">			main();</div><div class="line">			  â¬‡ï¸</div><div class="line">**åˆå§‹åŒ–__main_block_impl_0 ç»“æ„ä½“**</div><div class="line">			  â¬‡ï¸</div><div class="line">**å°†ç»“æ„ä½“åœ°å€èµ‹å€¼ç»™*blockå‡½æ•°æŒ‡é’ˆ**</div><div class="line">			  â¬‡ï¸</div><div class="line">**è°ƒç”¨blockå‡½æ•°æŒ‡é’ˆçš„FuncPtrå‡½æ•°**</div><div class="line">			  â¬‡ï¸</div><div class="line">			**ç»“æŸ**</div></pre></td></tr></table></figure>
<h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p> <code>Block</code>è¿˜æœ‰æˆªè·è‡ªåŠ¨å˜é‡ã€__blockä¿®é¥°ç¬¦ã€blockå­˜å‚¨åŸŸå³ä¸Šæ–‡æåˆ°çš„ä¸‰ç§blockç±»å‹ï¼Œå†…å­˜ç®¡ç†ç­‰ç­‰é—®é¢˜å¾…æˆ‘ç»†ç»†ç ”ä¹ ä¹‹åå†å†™æ€»ç»“ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://book.douban.com/subject/24720270/" target="_blank" rel="external">ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹</a></li>
<li><a href="http://blog.devtang.com/2013/07/28/a-look-inside-blocks/" target="_blank" rel="external">è°ˆObjective-C blockçš„å®ç°</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="external">å­¦ä¹ Javascripté—­åŒ…(Closure)</a></li>
<li><a href="http://www.cnblogs.com/biosli/archive/2013/05/29/iOS_Objective-C_Block.html" target="_blank" rel="external">å¯¹Objective-Cä¸­Blockçš„è¿½æ¢</a></li>
</ul>
<p>&lt;!â€” more â€“&gt;</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ–‡ç« æ˜¯é˜…è¯»&lt;a href=&quot;https://book.douban.com/subject/24720270/&quot;&gt;ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹&lt;/a&gt;ä¹‹åçš„ä¸€äº›ç†è§£æ€»ç»“ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç†è§£Blockå¦‚ä½•å®ç°,éœ€è¦äº†è§£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯&lt;code&gt;Block&lt;/code&gt;?&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Block&lt;/code&gt;çš„è¯­æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯Block&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯Block&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯Block&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯Block&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Block&lt;/code&gt;æ˜¯&lt;code&gt;C&lt;/code&gt;è¯­è¨€çš„æ‹“å±•åŠŸèƒ½ã€‚åœ¨Appleæ–‡æ¡£ä¸­æœ‰ä¸€å¥è¯è¯´æ˜ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;In other languages and environments, a block object is sometimes also called a closure or a lambda.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å…¶ä»–è¯­è¨€å’Œç¯å¢ƒï¼Œä¸€ä¸ª&lt;code&gt;block&lt;/code&gt;å¯¹è±¡æœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä½œ&lt;code&gt;closure&lt;/code&gt;é—­åŒ…æˆ–&lt;code&gt;^&lt;/code&gt;;&lt;/p&gt;
&lt;p&gt;åœ¨é˜®ä¸€å³°çš„&lt;a href=&quot;http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html&quot;&gt;å­¦ä¹ Javascripté—­åŒ…ï¼ˆClosureï¼‰&lt;/a&gt;ä¸­è§£é‡Šäº†ä»€ä¹ˆæ˜¯é—­åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é—­åŒ…å°±æ˜¯èƒ½å¤Ÿè¯»å–å…¶ä»–å‡½æ•°å†…éƒ¨å˜é‡çš„å‡½æ•°ã€‚&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://github.com/VeinGuo/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¸¸ç”¨æ•°æ®æŒä¹…åŒ–</title>
    <link href="https://github.com/VeinGuo/2016/11/28/iOS%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <id>https://github.com/VeinGuo/2016/11/28/iOSå¸¸ç”¨æ•°æ®æŒä¹…åŒ–/</id>
    <published>2016-11-28T07:47:00.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°æ®å±‚ä¸€ç›´æ˜¯ç¨‹åºçš„æ ¸å¿ƒç»“æ„ä¹‹ä¸€ï¼Œåœ¨iOSå¼€å‘è¿‡ç¨‹ä¸­é€šå¸¸éœ€è¦å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç¼“å­˜ä»¥ä¿è¯åœ¨æ— ç½‘ç»œæƒ…å†µä¸‹æ‰“å¼€Appåè¿›è¡Œä¸€äº›å±•ç¤ºæˆ–ç¼“å­˜èŠå¤©è®°å½•ç­‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦æŒä¹…åŒ–æ•°æ®ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–"></a>ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–</h2><p>æ•°æ®æŒä¹…åŒ–å°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®æ¨¡å‹è½¬æ¢ä¸ºå­˜å‚¨æ¨¡å‹,ä»¥åŠå°†å­˜å‚¨æ¨¡å‹è½¬æ¢ä¸ºå†…å­˜ä¸­çš„æ•°æ®æ¨¡å‹çš„ç»Ÿç§°. æ•°æ®æ¨¡å‹å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç»“æ„æˆ–å¯¹è±¡æ¨¡å‹,å­˜å‚¨æ¨¡å‹å¯ä»¥æ˜¯å…³ç³»æ¨¡å‹ã€XMLã€äºŒè¿›åˆ¶æµç­‰ã€‚cmpå’ŒHibernateåªæ˜¯å¯¹è±¡æ¨¡å‹åˆ°å…³ç³»æ¨¡å‹ä¹‹é—´è½¬æ¢çš„ä¸åŒå®ç°ã€‚</p>
<h2 id="å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–"><a href="#å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–" class="headerlink" title="å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–"></a>å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–</h2><p>åœ¨é¡¹ç›®å¼€å‘ä¸­æˆ‘æœ€å¸¸ä½¿ç”¨çš„æŒä¹…åŒ–æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>NSUserDefault</li>
<li>Plistæ–‡ä»¶å­˜å‚¨ </li>
<li>NSKeyedArchiver å½’æ¡£</li>
<li>SQLite3(æ•°æ®åº“)</li>
</ul>
<a id="more"></a>
<h3 id="NSFileManager"><a href="#NSFileManager" class="headerlink" title="NSFileManager"></a>NSFileManager</h3><p>Plist å’Œ å½’æ¡£ ä½¿ç”¨æ–‡ä»¶æ“ä½œå­˜å‚¨éœ€è¦ç”¨åˆ°NSFileManagerï¼Œåˆ›å»ºä¸€ä¸ªå·¥å…·ç±»æ¥å¯¹Appçš„æ–‡ä»¶è¿›è¡Œ</p>
<p>NSFileManager æ˜¯å¤„ç†æ–‡ä»¶ç³»ç»Ÿçš„ Foundation æ¡†æ¶çš„é«˜çº§APIã€‚å®ƒæŠ½è±¡äº† Unix å’Œ Finder çš„å†…éƒ¨æ„æˆï¼Œå’Œ iCloud ubiquitous containers ä¸€æ ·ï¼Œ æä¾›äº†åˆ›å»ºï¼Œè¯»å–ï¼Œç§»åŠ¨ï¼Œæ‹·è´ä»¥åŠåˆ é™¤æœ¬åœ°æˆ–è€…ç½‘ç»œé©±åŠ¨å™¨ä¸Šçš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æ–¹æ³•ã€‚</p>
<p>NSFileManager æ˜¯ä¸€ä¸ªå•ä¾‹ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥è·å¾—</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Â + (<span class="built_in">NSFileManager</span> *)defaultManager</div></pre></td></tr></table></figure>
<p>NSFileManagerå¸¸ç”¨æ–¹æ³•å°±ä¸å¤šæäº†è¿™é‡Œéœ€è¦æçš„ä¸€ç‚¹æ˜¯çº¿ç¨‹æ³¨æ„ã€‚<br>apple ä¸­æåˆ°ï¼š</p>
<h4 id="Threading-Considerations"><a href="#Threading-Considerations" class="headerlink" title="Threading Considerations"></a>Threading Considerations</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The methods of the shared NSFileManager object can be called from multiple threads safely. However, if you use a delegate to receive notifications about the status of move, copy, remove, and link operations, you should create a unique instance of the file manager object, assign your delegate to that object, and use that file manager to initiate your operations.</div></pre></td></tr></table></figure>
<p>å¤§æ¦‚è¯´ä¸€ä¸‹æ„æ€å°±æ˜¯å…±äº«çš„NSFileManagerå¯¹è±¡æ–¹æ³•å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹è°ƒç”¨æ˜¯å®‰å…¨çš„ã€‚å¯æ˜¯ï¼Œå¦‚æœä½¿ç”¨å§”æ‰˜é€šçŸ¥çš„çŠ¶æ€ç§»åŠ¨ï¼Œå¤åˆ¶ï¼Œåˆ é™¤ç­‰ç­‰æ“ä½œï¼Œåº”è¯¥åˆ›å»ºä¸€ä¸ªå”¯ä¸€å®ä¾‹å¹¶ä½¿ç”¨è¯¥å®ä¾‹æ¥å¼€å§‹ä½ çš„æ“ä½œã€‚</p>
<p>å¦‚ä½¿ç”¨NSFileManagerDelegateæ—¶æœ€å¥½åˆ›å»ºå®ä¾‹æ¥è¿›è¡Œæ“ä½œ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSFileManager</span> *fileManager = [[<span class="built_in">NSFileManager</span> alloc] init];</div><div class="line">fileManager.delegate = delegate;</div><div class="line"></div><div class="line"><span class="built_in">NSURL</span> *bundleURL = [[<span class="built_in">NSBundle</span> mainBundle] bundleURL];</div><div class="line"><span class="built_in">NSArray</span> *contents = [fileManager contentsOfDirectoryAtURL:bundleURL</div><div class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  includingPropertiesForKeys:@[]</div><div class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options:<span class="built_in">NSDirectoryEnumerationSkipsHiddenFiles</span>Â </div><div class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  error:<span class="literal">nil</span>];</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *filePath <span class="keyword">in</span> contents) &#123;</div><div class="line">Â  Â  [fileManager removeItemAtPath:filePath error:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯æˆ‘å¼€å‘ä¸­ä¸€äº›å¸¸ç”¨çš„æ–‡ä»¶æ“ä½œæ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå­˜å‚¨æ–‡ä»¶å¤¹å¹¶è·å–è·¯å¾„</span></div><div class="line">+ (<span class="built_in">NSString</span> *)getDocumentPath</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">static</span> <span class="built_in">NSString</span> *documentPath = <span class="literal">nil</span>;</div><div class="line">Â  Â  <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">Â  Â  <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSArray</span> *paths = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>);</div><div class="line">Â  Â  Â  Â  documentPath = [[<span class="built_in">NSString</span> alloc]initWithFormat:<span class="string">@"%@/%@/"</span>,[paths objectAtIndex:<span class="number">0</span>],FOLDER_FILE_NAME];</div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (![[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:documentPath])</div><div class="line">Â  Â  Â  Â  &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  [[<span class="built_in">NSFileManager</span> defaultManager] createDirectoryAtPath:documentPath</div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  withIntermediateDirectories:<span class="literal">NO</span></div><div class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attributes:<span class="literal">nil</span></div><div class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  error:<span class="literal">nil</span>];</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;);</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">return</span> documentPath;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ–‡ä»¶å¤§å°</span></div><div class="line">+ (<span class="built_in">NSUInteger</span>)getFileSizeAtFileName:(<span class="built_in">NSString</span>*)fileName&#123;</div><div class="line">  <span class="built_in">NSString</span> *path = [[VGFileManagerCommon getDocumentPath] stringByAppendingPathComponent:fileName];</div><div class="line">Â  Â  <span class="keyword">return</span> [[[<span class="built_in">NSFileManager</span> defaultManager] attributesOfItemAtPath:path error:<span class="literal">nil</span>]fileSize];</div><div class="line">&#125;</div><div class="line"><span class="comment">// æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></div><div class="line">+ (<span class="built_in">BOOL</span>)isFileExistAtPath:(<span class="built_in">NSString</span>*)filePath</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">BOOL</span> isExist = <span class="literal">NO</span>;</div><div class="line">Â  Â  isExist = [[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:filePath];</div><div class="line">Â  Â  <span class="keyword">return</span> isExist;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></div><div class="line">+ (<span class="built_in">BOOL</span>)isFileExistAtFileName:(<span class="built_in">NSString</span>*)fileName</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">NSString</span> *path = [[VGFileManagerCommon getDocumentPath] stringByAppendingPathComponent:fileName];</div><div class="line">Â  Â  <span class="keyword">return</span> [VGFileManagerCommon isFileExistAtPath:path];</div><div class="line">&#125;</div><div class="line"><span class="comment">// åˆ é™¤æ–‡ä»¶</span></div><div class="line">+ (<span class="built_in">BOOL</span>)deleteFileAtFileName:(<span class="built_in">NSString</span> *)fileName</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">NSFileManager</span> Â  *fileMgr = [<span class="built_in">NSFileManager</span> defaultManager];</div><div class="line">Â  Â  <span class="built_in">NSString</span> *deletePath = [[VGFileManagerCommon getDocumentPath] stringByAppendingPathComponent:fileName];</div><div class="line">Â  Â  <span class="built_in">NSError</span> *err = <span class="literal">nil</span>;</div><div class="line">Â  Â  [fileMgr removeItemAtPath:deletePath error:&amp;err];</div><div class="line">Â  Â  <span class="keyword">return</span> err != <span class="literal">nil</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="NSUserDefault"><a href="#NSUserDefault" class="headerlink" title="NSUserDefault"></a>NSUserDefault</h3><p>å¸¸ç”¨æ¥å­˜å‚¨ä¸€ä¸ªç®€å•çš„çŠ¶æ€å¦‚æ˜¯å¦ç¬¬ä¸€æ¬¡ç™»é™†</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSUserDefaults</span> *userDefaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</div><div class="line">[userDefaults setBool:<span class="literal">YES</span> forKey:<span class="string">@"firstLogin"</span>];</div><div class="line">[userDefaults synchronize];</div></pre></td></tr></table></figure>
<h3 id="Plistæ–‡ä»¶å­˜å‚¨"><a href="#Plistæ–‡ä»¶å­˜å‚¨" class="headerlink" title="Plistæ–‡ä»¶å­˜å‚¨"></a>Plistæ–‡ä»¶å­˜å‚¨</h3><p>Property Listï¼Œå±æ€§åˆ—è¡¨æ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥å­˜å‚¨ä¸²è¡ŒåŒ–åçš„å¯¹è±¡çš„æ–‡ä»¶ã€‚å±æ€§åˆ—è¡¨æ–‡ä»¶çš„æ‰©å±•åä¸º.plist ï¼Œplistæ–‡ä»¶çš„å®è´¨ä¸ºXMLæ–‡ä»¶ã€‚</p>
<p>å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»å‹åªæœ‰å¦‚ä¸‹å‡ ç§ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span>Â </div><div class="line"><span class="built_in">NSMutableArray</span></div><div class="line"><span class="built_in">NSDictionary</span>Â </div><div class="line"><span class="built_in">NSMutableDictionary</span></div><div class="line"><span class="built_in">NSData</span>Â </div><div class="line"><span class="built_in">NSMutableData</span></div><div class="line"><span class="built_in">NSString</span>Â </div><div class="line"><span class="built_in">NSMutableString</span></div><div class="line"><span class="built_in">NSNumber</span></div><div class="line"><span class="built_in">NSDate</span></div></pre></td></tr></table></figure>
<p>åœ¨å®é™…çš„å¼€å‘ä¸­æˆ‘ä¸€èˆ¬å­˜å‚¨NSArrayå’ŒNSDictonary<br>ç»è¿‡ä½¿ç”¨åå»ºè®®ä½¿ç”¨JSON å­˜å‚¨ å–å‡ºåè½¬æˆæ¨¡å‹ï¼Œé¿å…å¢å‡å­—æ®µçš„é—®é¢˜</p>
<p>å¼€å‘ä¸­ä¾‹å­</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)fetchItemsWithCompletion:(VGPlistStoreFetchCompletionHandler)completion&#123;</div><div class="line">Â  Â  <span class="built_in">NSDictionary</span> *cacheJson = [<span class="keyword">self</span> loadCache];</div><div class="line">Â  Â  <span class="keyword">if</span> (completion) &#123;</div><div class="line">Â  Â  Â  Â  completion(cacheJson);</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSDictionary</span> *)loadCache</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> savePath];</div><div class="line">Â  Â  <span class="keyword">if</span> ([VGFileManagerCommon isFileExistAtPath:path]) &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> [<span class="built_in">NSDictionary</span> dictionaryWithContentsOfFile:path];</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)savePath</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">return</span> [[VGFileManagerCommon getDocumentPath] stringByAppendingPathComponent:<span class="string">@"cache.plist"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)saveJSON:(<span class="built_in">NSDictionary</span> *)json</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">if</span> (json) &#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> savePath];</div><div class="line">Â  Â  Â  Â  [json writeToFile:path atomically:<span class="literal">YES</span>];</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="NSKeyedArchiver-å½’æ¡£"><a href="#NSKeyedArchiver-å½’æ¡£" class="headerlink" title="NSKeyedArchiver å½’æ¡£"></a>NSKeyedArchiver å½’æ¡£</h3><p>å½’æ¡£åªè¦éµå¾ªäº†NSCodingåè®®çš„å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡å®ƒå®ç°åºåˆ—åŒ–ã€‚<br>å¹³æ—¶é¡¹ç›®ä¸­ä½¿ç”¨Mantle æ¥å®ç°modelå±‚ Mantleå·²ç»å®ç°äº†NSCodingåè®®</p>
<p>Demoä¸­ä¾‹å­ç›´æ¥å­˜å‚¨model ä½†å»ºè®®è¿˜æ˜¯æŠŠModelè½¬æ¢æˆJSON Dictionary æ¥å­˜å‚¨loadæ—¶å†è½¬æ¢æˆmodel</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">instancetype</span>)store</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] init];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)fetchItemsWithCompletion:(VGKeyedArchiverStoreFetchCompletionHandler)completion</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">if</span> ([VGFileManagerCommon isFileExistAtPath:[<span class="keyword">self</span> savePath]]) &#123;</div><div class="line">Â  Â  Â  Â  VGCacheModel *model = [<span class="keyword">self</span> loadModel];</div><div class="line">Â  Â  Â  Â  completion(model);</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (VGCacheModel *)loadModel</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="keyword">return</span> [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:[<span class="keyword">self</span> savePath]];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSString</span> *)savePath</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">NSString</span> *path = <span class="string">@"keyedArchiverStore.bin"</span>;</div><div class="line">Â  Â  <span class="keyword">return</span> [[VGFileManagerCommon getDocumentPath] stringByAppendingPathComponent:path];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)saveModel:(VGCacheModel *)Model</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">BOOL</span> success = [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:Model toFile:[<span class="keyword">self</span> savePath]];</div><div class="line">Â  Â  <span class="keyword">if</span> (!success) &#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"Save Failed"</span>);</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SQLite3-æ•°æ®åº“"><a href="#SQLite3-æ•°æ®åº“" class="headerlink" title="SQLite3(æ•°æ®åº“)"></a>SQLite3(æ•°æ®åº“)</h3><p>ä¸€èˆ¬ç”¨æ¥å­˜å‚¨å¤§é‡çš„å†…å®¹å¹¶å¯å•ä¸€çš„ä¿®æ”¹æ›´æ–°æŸä¸€æ¡ç¼“å­˜ä¿¡æ¯ç­‰ã€‚å®é™…ä¸ŠSQLiteæ˜¯æ— ç±»å‹çš„ã€‚å³ä¸ç®¡ä½ åœ¨åˆ›è¡¨æ—¶æŒ‡å®šçš„å­—æ®µç±»å‹æ˜¯ä»€ä¹ˆï¼Œå­˜å‚¨æ˜¯ä¾ç„¶å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ã€‚è€Œä¸”åœ¨åˆ›è¡¨æ—¶ä¹Ÿå¯ä»¥ä¸æŒ‡å®šå­—æ®µç±»å‹ã€‚</p>
<p>å¼€å‘ä¸­æˆ‘ä¸€èˆ¬ä½¿ç”¨FMDBç¬¬ä¸‰æ–¹åº“æ¥è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œdemoä¸­ä¾‹å­å°±ä½¿ç”¨FMDBå®ç°ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºæ•°æ®åº“</span></div><div class="line">- (<span class="keyword">void</span>)openDatabase</div><div class="line">&#123;</div><div class="line">Â  Â  <span class="built_in">NSString</span> *filepath = [[VGFileManagerCommon getDocumentPath] stringByAppendingString:<span class="string">@"cache.db"</span>];</div><div class="line">Â  Â  FMDatabase *db = [FMDatabase databaseWithPath:filepath];</div><div class="line">Â  Â  <span class="keyword">if</span> ([db open])</div><div class="line">Â  Â  &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">self</span>.db = db;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSString</span> *sql = <span class="string">@"CREATE TABLE IF NOT EXISTS CACHE \</span></div><div class="line">Â  Â  Â  Â  (uid INTEGER PRIMARY KEY, \</div><div class="line">Â  Â  Â  Â  url TEXT, \</div><div class="line">Â  Â  Â  Â  title TEXT)";</div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (![<span class="keyword">self</span>.db executeUpdate:sql])</div><div class="line">Â  Â      &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"execute sql %@ error %@"</span>,sql,<span class="keyword">self</span>.db.lastError);</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="keyword">else</span></div><div class="line">Â  Â  &#123;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"open database failed %@"</span>,filepath);</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - public</span></div><div class="line"></div><div class="line">- (<span class="built_in">NSArray</span> &lt;VGCacheModel *&gt;*)fetchCacheModelWithLimit:(<span class="built_in">NSInteger</span>)limit&#123;</div><div class="line">    __block <span class="built_in">NSArray</span> *result = <span class="literal">nil</span>;</div><div class="line">    <span class="built_in">NSString</span> *sql = <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">if</span> (limit) &#123;</div><div class="line">        sql = <span class="string">@"SELECT *FROM CACHE ORDER BY uid DESC LIMIT ?"</span>;</div><div class="line">    &#125;</div><div class="line">    db_sync_safe(^&#123;</div><div class="line">        <span class="built_in">NSMutableArray</span> &lt;VGCacheModel *&gt;*array = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">        FMResultSet *rs = [<span class="keyword">self</span>.db executeQuery:sql, @(limit)];</div><div class="line">        <span class="keyword">while</span> ([rs next]) &#123;</div><div class="line">            VGCacheModel *model = loadToDatabase(rs);</div><div class="line">            [array addObject:model];</div><div class="line">        &#125;</div><div class="line">        [rs close];</div><div class="line">        result = array;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)saveModels:(<span class="built_in">NSArray</span> &lt;VGCacheModel *&gt;*)models&#123;</div><div class="line">    db_sync_safe(^&#123;</div><div class="line">        <span class="keyword">if</span> ([models count]) &#123;</div><div class="line">            [<span class="keyword">self</span>.db beginTransaction];</div><div class="line">            <span class="keyword">for</span> (VGCacheModel*model <span class="keyword">in</span> models) &#123;</div><div class="line">                saveToDatabase(<span class="keyword">self</span>.db, model);</div><div class="line">            &#125;</div><div class="line">            [<span class="keyword">self</span>.db commit];</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)updateModel:(VGCacheModel *)model&#123;</div><div class="line">    <span class="built_in">NSString</span> *sql = <span class="string">@"UPDATE CACHE SET TITLE = ? WHRER uid = ?"</span>;</div><div class="line">    db_async(^&#123;</div><div class="line">        <span class="keyword">if</span> (![<span class="keyword">self</span>.db executeUpdate:sql, model.title, model.uid]) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"update failed sql %@"</span>,sql);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - save &amp; load</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> VGCacheModel * loadToDatabase(FMResultSet *resultSet)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSInteger</span> uid = [resultSet longLongIntForColumn:<span class="string">@"uid"</span>];</div><div class="line">    <span class="built_in">NSString</span> *URL = [resultSet stringForColumn:<span class="string">@"url"</span>];</div><div class="line">    <span class="built_in">NSString</span> *title = [resultSet stringForColumn:<span class="string">@"title"</span>];</div><div class="line">    </div><div class="line">    VGCacheModel *model = [[VGCacheModel alloc] init];</div><div class="line">    model.uid = uid;</div><div class="line">    model.imageURL = URL;</div><div class="line">    model.title = title;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> model;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> saveToDatabase(FMDatabase *db, VGCacheModel *model)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *sql = <span class="string">@"INSERT OR REPLACE INTO CACHE(uid, url, title) VALUES(?,?,?)"</span>;</div><div class="line">    <span class="keyword">if</span>(![db executeUpdate:sql,</div><div class="line">        @(model.uid),</div><div class="line">        model.imageURL,</div><div class="line">        model.title])&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"update failed sql %@"</span>,sql);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - Queue</span></div><div class="line"><span class="built_in">dispatch_queue_t</span> cacheDatabaseQueue()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_queue_t</span> queue;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        queue = dispatch_queue_create(databaseQueue, <span class="number">0</span>);</div><div class="line">        dispatch_queue_set_specific(queue, kDatabaseQueueSpecificKey, (<span class="keyword">void</span> *)kDatabaseQueueSpecificKey, <span class="literal">NULL</span>);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> queue;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^dispatch_block)(<span class="keyword">void</span>);</div><div class="line"><span class="keyword">void</span> db_sync_safe(dispatch_block block)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (dispatch_get_specific(kDatabaseQueueSpecificKey))</div><div class="line">    &#123;</div><div class="line">        block();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">dispatch_sync</span>(cacheDatabaseQueue(), ^() &#123;</div><div class="line">            block();</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> db_async(dispatch_block block)&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(cacheDatabaseQueue(), ^() &#123;</div><div class="line">        block();</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><p>æ–‡ç« ä¸­ä¾‹å­çš„å®Œæ•´ä»£ç <br>Demoç®€å•çš„å®ç°äº†Plistã€NSKeyedArchiver å½’æ¡£ã€SQLite3(æ•°æ®åº“) ä¸‰ç§æ•°æ®æŒä¹…åŒ–<br><a href="https://github.com/VeinGuo/VGCacheDemo.git">VGCacheDemo</a></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="http://nshipster.com/nsfilemanager/" target="_blank" rel="external">NSHipster NSFileManager</a></li>
<li><a href="http://www.jianshu.com/p/119fb5bdf30a" target="_blank" rel="external">iOSä¸­çš„æ•°æ®æŒä¹…åŒ–</a></li>
<li><a href="http://www.jianshu.com/p/7616cbd72845" target="_blank" rel="external">æˆ‘è¦æ°¸è¿œåœ°è®°ä½ä½ ï¼(iOSä¸­å‡ ç§æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ)</a></li>
</ul>
<p>&lt;!â€” more â€“&gt;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ•°æ®å±‚ä¸€ç›´æ˜¯ç¨‹åºçš„æ ¸å¿ƒç»“æ„ä¹‹ä¸€ï¼Œåœ¨iOSå¼€å‘è¿‡ç¨‹ä¸­é€šå¸¸éœ€è¦å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç¼“å­˜ä»¥ä¿è¯åœ¨æ— ç½‘ç»œæƒ…å†µä¸‹æ‰“å¼€Appåè¿›è¡Œä¸€äº›å±•ç¤ºæˆ–ç¼“å­˜èŠå¤©è®°å½•ç­‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦æŒä¹…åŒ–æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯æ•°æ®æŒä¹…åŒ–&lt;/h2&gt;&lt;p&gt;æ•°æ®æŒä¹…åŒ–å°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®æ¨¡å‹è½¬æ¢ä¸ºå­˜å‚¨æ¨¡å‹,ä»¥åŠå°†å­˜å‚¨æ¨¡å‹è½¬æ¢ä¸ºå†…å­˜ä¸­çš„æ•°æ®æ¨¡å‹çš„ç»Ÿç§°. æ•°æ®æ¨¡å‹å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç»“æ„æˆ–å¯¹è±¡æ¨¡å‹,å­˜å‚¨æ¨¡å‹å¯ä»¥æ˜¯å…³ç³»æ¨¡å‹ã€XMLã€äºŒè¿›åˆ¶æµç­‰ã€‚cmpå’ŒHibernateåªæ˜¯å¯¹è±¡æ¨¡å‹åˆ°å…³ç³»æ¨¡å‹ä¹‹é—´è½¬æ¢çš„ä¸åŒå®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–&quot;&gt;&lt;/a&gt;å¸¸ç”¨çš„æ•°æ®æŒä¹…åŒ–&lt;/h2&gt;&lt;p&gt;åœ¨é¡¹ç›®å¼€å‘ä¸­æˆ‘æœ€å¸¸ä½¿ç”¨çš„æŒä¹…åŒ–æ–¹å¼æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSUserDefault&lt;/li&gt;
&lt;li&gt;Plistæ–‡ä»¶å­˜å‚¨ &lt;/li&gt;
&lt;li&gt;NSKeyedArchiver å½’æ¡£&lt;/li&gt;
&lt;li&gt;SQLite3(æ•°æ®åº“)&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Objective-C" scheme="https://github.com/VeinGuo/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>Learn Swift - 2 (Tuple)</title>
    <link href="https://github.com/VeinGuo/2016/09/29/Learn%20Swift%20-%202%20Tuple(%E5%85%83%E7%BB%84)/"/>
    <id>https://github.com/VeinGuo/2016/09/29/Learn Swift - 2 Tuple(å…ƒç»„)/</id>
    <published>2016-09-29T07:52:00.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Tuple-å…ƒç»„"><a href="#Tuple-å…ƒç»„" class="headerlink" title="Tuple(å…ƒç»„)"></a>Tuple(å…ƒç»„)</h3><blockquote>
<p>&nbsp; Tuples group multiple values into a single compound value. The values within a tuple can be of any type and do not have to be of the same type as each other.<br>&nbsp; å…ƒç»„ï¼ˆtuplesï¼‰æŠŠå¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªå¤åˆå€¼ã€‚å…ƒç»„å†…çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå¹¶ä¸è¦æ±‚æ˜¯ç›¸åŒç±»å‹ã€‚</p>
</blockquote>
<hr>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = (<span class="string">"Vein"</span>, <span class="number">66</span>)</div></pre></td></tr></table></figure>
<p>&nbsp; ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>ï¼ˆâ€œVeinâ€, 66ï¼‰</code> æ˜¯ä¸€ä¸ªäººçš„å§“åå’Œä½“é‡çš„å…ƒç»„ã€‚<br><code>(&quot;Vein&quot;, 66)</code> å…ƒç»„æŠŠä¸€ä¸ª<code>String</code> å’Œä¸€ä¸ª<code>Int</code> ä¸¤ä¸ªä¸åŒçš„ç±»å‹ç»„åˆèµ·æ¥ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥éšæ„ç»„åˆä¸åŒç±»å‹å¦‚ï¼šï¼ˆ<code>Int</code>, <code>Int</code>, <code>Double</code>ã€(<code>String</code>, <code>Bool</code>)æˆ–è€…ï¼ˆ<code>String</code>, <code>String</code>, <code>String</code>)ç­‰ç­‰å…¶ä»–ä»»ä½•ä½ æƒ³ç»„åˆçš„å…ƒç»„ã€‚</p>
<a id="more"></a>
<h5 id="åˆ†è§£ï¼ˆdecomposeï¼‰"><a href="#åˆ†è§£ï¼ˆdecomposeï¼‰" class="headerlink" title="åˆ†è§£ï¼ˆdecomposeï¼‰"></a>åˆ†è§£ï¼ˆdecomposeï¼‰</h5><p>ä½ å¯ä»¥åˆ†è§£å…ƒç»„çš„å†…å®¹ï¼Œå˜æˆå•ç‹¬çš„å¸¸é‡å’Œå˜é‡ï¼Œç„¶åä½ å¯ä»¥æ‹¿æ¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> (name, weight) = person</div><div class="line"><span class="built_in">print</span>(<span class="string">"å§“å:<span class="subst">\(name)</span>"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"ä½“é‡:<span class="subst">\(weight)</span>"</span>)</div></pre></td></tr></table></figure>
<p>è¿‡æ»¤æ‰æŸä¸€éƒ¨åˆ†çš„è¯å¯ä»¥ä½¿ç”¨<code>ï¼ˆ_, weightï¼‰</code>çš„æ–¹æ³•ï¼Œè¿™æ ·åªå–å‡ºå…ƒç»„ä¸­çš„weight:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> (<span class="number">_</span> ,weight) = person</div><div class="line"><span class="built_in">print</span>(<span class="string">"ä½“é‡:<span class="subst">\(weight)</span>"</span>)</div></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥åƒå–æ•°ç»„ä¸­å…ƒç´ ä¸€æ ·ï¼Œä½¿ç”¨ä¸‹æ ‡è·å–å…ƒç»„ä¸­çš„å…ƒç´ ï¼Œä¸‹æ ‡ä»<code>0</code>å¼€å§‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="string">"å§“å:<span class="subst">\(person.<span class="number">0</span>)</span>"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"ä½“é‡:<span class="subst">\(person.<span class="number">1</span>)</span>"</span>)</div></pre></td></tr></table></figure>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨å®šä¹‰å…ƒç»„æ—¶å°±å¯¹å•ä¸ªå…ƒç´ å‘½åå¹¶ç”¨å‘½åæ¥è·å–è¿™äº›å…ƒç´ çš„å€¼ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = (name: <span class="string">"Vein"</span>, weight: <span class="number">66</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"å§“å:<span class="subst">\(person.name)</span>"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"ä½“é‡:<span class="subst">\(person.weight)</span>"</span>)</div></pre></td></tr></table></figure>
<h4 id="å…ƒç»„å®é™…çš„åº”ç”¨ä¾‹å­"><a href="#å…ƒç»„å®é™…çš„åº”ç”¨ä¾‹å­" class="headerlink" title="å…ƒç»„å®é™…çš„åº”ç”¨ä¾‹å­"></a>å…ƒç»„å®é™…çš„åº”ç”¨ä¾‹å­</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxValueAndMinValue</span> <span class="params">( values:[Int] )</span></span> -&gt; (<span class="built_in">max</span>:<span class="type">Int</span>, <span class="built_in">min</span>:<span class="type">Int</span>)    &#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> maxValue = values[<span class="number">0</span>]</div><div class="line">    <span class="keyword">var</span> minValue = values[<span class="number">0</span>]</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> values</div><div class="line">    &#123;</div><div class="line">        maxValue = <span class="built_in">max</span>(maxValue, value)</div><div class="line">        minValue = <span class="built_in">min</span>(minValue, value)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> (maxValue, minValue)</div><div class="line">&#125;</div><div class="line">maxValueAndMinValue(values: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>])</div></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªå‡½æ•°ä½¿ç”¨å…ƒç»„è¿”å›ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ª<code>max</code>å’Œä¸€ä¸ª<code>min</code></p>
<blockquote>
<p>&nbsp; Tuples are particularly useful as the return values of functions. A function that tries to retrieve a web page might return the (Int, String) tuple type to describe the success or failure of the page retrieval. By returning a tuple with two distinct values, each of a different type, the function provides more useful information about its outcome than if it could only return a single value of a single type. For more information, see Functions with Multiple Return Values.<br>&nbsp; ä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶ï¼Œå…ƒç»„éå¸¸æœ‰ç”¨ã€‚ä¸€ä¸ªç”¨æ¥è·å–ç½‘é¡µçš„å‡½æ•°å¯èƒ½ä¼šè¿”å›ä¸€ä¸ª (Int, String) å…ƒç»„æ¥æè¿°æ˜¯å¦è·å–æˆåŠŸã€‚å’Œåªèƒ½è¿”å›ä¸€ä¸ªç±»å‹çš„å€¼æ¯”è¾ƒèµ·æ¥ï¼Œä¸€ä¸ªåŒ…å«ä¸¤ä¸ªä¸åŒç±»å‹å€¼çš„å…ƒç»„å¯ä»¥è®©å‡½æ•°çš„è¿”å›ä¿¡æ¯æ›´æœ‰ç”¨ã€‚è¯·å‚è€ƒå‡½æ•°å‚æ•°ä¸è¿”å›å€¼ã€‚</p>
</blockquote>
<h3 id="NOTE-æ³¨æ„"><a href="#NOTE-æ³¨æ„" class="headerlink" title="NOTE(æ³¨æ„)"></a>NOTE(æ³¨æ„)</h3><blockquote>
<p>&nbsp; Tuples are useful for temporary groups of related values. They are not suited to the creation of complex data structures. If your data structure is likely to persist beyond a temporary scope, model it as a class or structure, rather than as a tuple. For more information, see Classes and Structures.<br>&nbsp; å…ƒç»„åœ¨ä¸´æ—¶ç»„ç»‡å€¼çš„æ—¶å€™å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¹¶ä¸é€‚åˆåˆ›å»ºå¤æ‚çš„æ•°æ®ç»“æ„ã€‚å¦‚æœä½ çš„æ•°æ®ç»“æ„å¹¶ä¸æ˜¯ä¸´æ—¶ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨ç±»æˆ–è€…ç»“æ„ä½“è€Œä¸æ˜¯å…ƒç»„ã€‚è¯·å‚è€ƒç±»å’Œç»“æ„ä½“ã€‚</p>
</blockquote>
<hr>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://wiki.jikexueyuan.com/project/swift/" target="_blank" rel="external">The Swift Programming Language ä¸­æ–‡ç‰ˆ</a></p>
<p><a href="https://developer.apple.com/library/prerelease/content/documentation/Swift/Conceptual/Swift_Programming_Language/index.html#//apple_ref/doc/uid/TP40014097-CH3-ID0" target="_blank" rel="external">The Swift Programming Language (Swift 3)</a></p>
<p>&lt;!â€” more â€“&gt;</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Tuple-å…ƒç»„&quot;&gt;&lt;a href=&quot;#Tuple-å…ƒç»„&quot; class=&quot;headerlink&quot; title=&quot;Tuple(å…ƒç»„)&quot;&gt;&lt;/a&gt;Tuple(å…ƒç»„)&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&amp;nbsp; Tuples group multiple values into a single compound value. The values within a tuple can be of any type and do not have to be of the same type as each other.&lt;br&gt;&amp;nbsp; å…ƒç»„ï¼ˆtuplesï¼‰æŠŠå¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªå¤åˆå€¼ã€‚å…ƒç»„å†…çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå¹¶ä¸è¦æ±‚æ˜¯ç›¸åŒç±»å‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h4 id=&quot;Example&quot;&gt;&lt;a href=&quot;#Example&quot; class=&quot;headerlink&quot; title=&quot;Example&quot;&gt;&lt;/a&gt;Example&lt;/h4&gt;&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; person = (&lt;span class=&quot;string&quot;&gt;&quot;Vein&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;66&lt;/span&gt;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;nbsp; ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ&lt;code&gt;ï¼ˆâ€œVeinâ€, 66ï¼‰&lt;/code&gt; æ˜¯ä¸€ä¸ªäººçš„å§“åå’Œä½“é‡çš„å…ƒç»„ã€‚&lt;br&gt;&lt;code&gt;(&amp;quot;Vein&amp;quot;, 66)&lt;/code&gt; å…ƒç»„æŠŠä¸€ä¸ª&lt;code&gt;String&lt;/code&gt; å’Œä¸€ä¸ª&lt;code&gt;Int&lt;/code&gt; ä¸¤ä¸ªä¸åŒçš„ç±»å‹ç»„åˆèµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥éšæ„ç»„åˆä¸åŒç±»å‹å¦‚ï¼šï¼ˆ&lt;code&gt;Int&lt;/code&gt;, &lt;code&gt;Int&lt;/code&gt;, &lt;code&gt;Double&lt;/code&gt;ã€(&lt;code&gt;String&lt;/code&gt;, &lt;code&gt;Bool&lt;/code&gt;)æˆ–è€…ï¼ˆ&lt;code&gt;String&lt;/code&gt;, &lt;code&gt;String&lt;/code&gt;, &lt;code&gt;String&lt;/code&gt;)ç­‰ç­‰å…¶ä»–ä»»ä½•ä½ æƒ³ç»„åˆçš„å…ƒç»„ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Learn Swift" scheme="https://github.com/VeinGuo/tags/Learn-Swift/"/>
    
  </entry>
  
  <entry>
    <title>Learn Swift - 1 (åŸºç¡€ç±»å‹)</title>
    <link href="https://github.com/VeinGuo/2016/09/25/Learn%20Swift%20-%201%20(%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B)/"/>
    <id>https://github.com/VeinGuo/2016/09/25/Learn Swift - 1 (åŸºç¡€ç±»å‹)/</id>
    <published>2016-09-25T03:38:42.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>&nbsp;  Apple å‘å¸ƒäº†Swift 3.0,ç‰ˆæœ¬è¯­æ³•åº”è¯¥ç›¸å¯¹ç¨³å®šäº†ï¼Œå¼€å§‹æ–°ä¸€è½®å­¦ä¹ ã€‚</p>
<p>&nbsp;  Swiftå­¦ä¹ ä¸»è¦ä»The Basicså¼€å§‹å­¦ä¹ ï¼Œè™½ç„¶ä¹‹å‰å·²ç»å­¦ä¹ è¿‡Objective-C,ä½†è¿˜æ˜¯è¿‡ä¸€éåŸºæœ¬çš„è¯­æ³•ã€‚</p>
<hr>
<blockquote>
<p><code>Swift</code> provides its own versions of all fundamental <code>C</code> and <code>Objective-C</code> types, including <code>Int</code> for integers, Doubleand <code>Float</code> for floating-point values, <code>Bool</code> for Boolean values, and <code>String</code> for textual data. <code>Swift</code> also provides powerful versions of the three primary collection types, <code>Array</code>, <code>Set</code>, and <code>Dictionary</code></p>
</blockquote>
<a id="more"></a>
<h3 id="Naming-Constants-and-Variablesï¼ˆå¸¸é‡ä¸å˜é‡ï¼‰"><a href="#Naming-Constants-and-Variablesï¼ˆå¸¸é‡ä¸å˜é‡ï¼‰" class="headerlink" title="Naming Constants and Variablesï¼ˆå¸¸é‡ä¸å˜é‡ï¼‰"></a>Naming Constants and Variablesï¼ˆå¸¸é‡ä¸å˜é‡ï¼‰</h3><ol>
<li>å¸¸é‡ä½¿ç”¨ <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2. å˜é‡ä½¿ç”¨ ```var</div></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> maximumNuberOfLoginAttempts = <span class="number">10</span></div><div class="line"><span class="keyword">var</span> currentLoginAttempts = <span class="number">0</span></div></pre></td></tr></table></figure>
<h3 id="Printing-Constants-and-Variables-ç±»å‹æ ‡æ³¨"><a href="#Printing-Constants-and-Variables-ç±»å‹æ ‡æ³¨" class="headerlink" title="Printing Constants and Variables(ç±»å‹æ ‡æ³¨)"></a>Printing Constants and Variables(ç±»å‹æ ‡æ³¨)</h3><p>ç±»å‹å’Œå¤§éƒ¨åˆ†å˜æˆè¯­æ³•ç›¸åŒæœ‰</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> welcomeMessage: <span class="type">String</span></div><div class="line"></div><div class="line">welcomeMessage = <span class="string">"Hi big brother"</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> red, green, blue: <span class="type">Double</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"ä½ å¥½,å¤§å…„å¼Ÿã€‚<span class="subst">\(welcomeMessage)</span>"</span>)</div><div class="line"></div><div class="line"><span class="keyword">let</span> cat = <span class="string">"ğŸ±"</span>; <span class="built_in">print</span>(cat)</div></pre></td></tr></table></figure>
<h3 id="Type-Safety-and-Type-Inference-ç±»å‹å®‰å…¨å’Œç±»å‹æ¨æ–­"><a href="#Type-Safety-and-Type-Inference-ç±»å‹å®‰å…¨å’Œç±»å‹æ¨æ–­" class="headerlink" title="Type Safety and Type Inference(ç±»å‹å®‰å…¨å’Œç±»å‹æ¨æ–­)"></a>Type Safety and Type Inference(ç±»å‹å®‰å…¨å’Œç±»å‹æ¨æ–­)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> minValue = <span class="type">UInt8</span>.<span class="built_in">min</span></div><div class="line"><span class="keyword">let</span> maxValue = <span class="type">UInt8</span>.<span class="built_in">max</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">let</span> meaningOfLife = <span class="number">42</span></div><div class="line"><span class="comment">// Â è‡ªåŠ¨æ¨æ–­ä¸º Int ç±»å‹</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> pi = <span class="number">3.1415926</span></div><div class="line"><span class="comment">// æ¨æ–­ä¸º Double ç±»å‹</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> anotherPi = <span class="number">3</span> + <span class="number">0.14159</span></div><div class="line"><span class="comment">// Double ç±»å‹</span></div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 17</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> decimalInteger = <span class="number">17</span></div><div class="line"><span class="keyword">let</span> binaryInteger = <span class="number">0b10001</span></div><div class="line"><span class="keyword">let</span> octalInteger = <span class="number">0o21</span></div><div class="line"><span class="keyword">let</span> hexadeimalInteger = <span class="number">0x11</span></div></pre></td></tr></table></figure>
<h4 id="Numeric-Type-Conversion-æ•°å­—ç±»å‹è½¬æ¢"><a href="#Numeric-Type-Conversion-æ•°å­—ç±»å‹è½¬æ¢" class="headerlink" title="Numeric Type Conversion(æ•°å­—ç±»å‹è½¬æ¢)"></a>Numeric Type Conversion(æ•°å­—ç±»å‹è½¬æ¢)</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ•´æ•°è½¬æ¢</span></div><div class="line"><span class="comment">// let cannotBeNegative: UInt8 = -1</span></div><div class="line"><span class="comment">// UInt8 ç±»å‹ä¸èƒ½å­˜å‚¨è´Ÿæ•°</span></div><div class="line"></div><div class="line"><span class="comment">// let tooBig: Int8 = Int8.max + 1</span></div><div class="line"><span class="comment">// Int8 ç±»å‹ä¸èƒ½å­˜å‚¨è¶…è¿‡æœ€å¤§å€¼çš„æ•°ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> twoThousand: <span class="type">UInt16</span> = <span class="number">2_000</span>  <span class="comment">// è¿™é‡Œ2_000 ä¸ 2000 ç›¸åŒ</span></div><div class="line"><span class="keyword">let</span> one: <span class="type">UInt8</span> = <span class="number">1</span></div><div class="line"><span class="keyword">let</span> twoThousandAndOne = twoThousand + <span class="type">UInt16</span>(one)</div><div class="line"></div><div class="line"><span class="comment">// UInt16 ä¸ UInt8 æ•´æ•°ç±»å‹ç›¸åŠ  ç”±äºå­˜å‚¨ä¸åŒèŒƒå›´çš„å€¼ï¼Œæ‰€ä»¥å¿…é¡»ä¸åŒæƒ…å†µé€‰æ‹©æ€§ä¸åŒæ•°å€¼ç±»å‹è½¬æ¢ã€‚</span></div><div class="line"><span class="comment">// UInt8 + UInt16    å…ˆæŠŠ UInt8 -&gt; UInt16 åå†è¿›è¡Œè¿ç®—</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> SomeType(ofInitialValue) æ˜¯è°ƒç”¨ Swift æ„é€ å™¨å¹¶ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼çš„é»˜è®¤æ–¹æ³•ã€‚</div><div class="line"> åœ¨è¯­è¨€å†…éƒ¨ï¼ŒUInt16 æœ‰ä¸€ä¸ªæ„é€ å™¨ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªUInt8ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªæ„é€ å™¨å¯ä»¥ç”¨ç°æœ‰çš„ UInt8 æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ UInt16ã€‚</div><div class="line"> æ³¨æ„ï¼Œä½ å¹¶ä¸èƒ½ä¼ å…¥ä»»æ„ç±»å‹çš„å€¼ï¼Œåªèƒ½ä¼ å…¥ UInt16 å†…éƒ¨æœ‰å¯¹åº”æ„é€ å™¨çš„å€¼ã€‚</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="Type-Aliases-ç±»å‹åˆ«å"><a href="#Type-Aliases-ç±»å‹åˆ«å" class="headerlink" title="Type Aliases(ç±»å‹åˆ«å)"></a>Type Aliases(ç±»å‹åˆ«å)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Type Aliases</span></div><div class="line"></div><div class="line"><span class="keyword">typealias</span> <span class="type">Vein</span> = <span class="type">UInt16</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> maxVein = <span class="type">Vein</span>.<span class="built_in">max</span></div></pre></td></tr></table></figure>
<h3 id="Booleans-å¸ƒå°”ç±»å‹"><a href="#Booleans-å¸ƒå°”ç±»å‹" class="headerlink" title="Booleans(å¸ƒå°”ç±»å‹)"></a>Booleans(å¸ƒå°”ç±»å‹)</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Booleans</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> orangesAreOrange = <span class="literal">true</span></div><div class="line"><span class="keyword">let</span> turnipsAreDelicious = <span class="literal">false</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> turnipsAreDelicious &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"1"</span>)</div><div class="line">&#125;<span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"2"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// this example will not compile, and will report an error</span></div><div class="line"><span class="keyword">let</span> i = <span class="number">1</span></div><div class="line"><span class="keyword">if</span> <span class="number">1</span> &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> i = <span class="number">1</span></div><div class="line"><span class="keyword">if</span> i == <span class="number">1</span> &#123;</div><div class="line">    <span class="comment">// this example will compile successfully</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// i == 1 comparison is of type Bool</span></div></pre></td></tr></table></figure>
<hr>
<p>å…ƒç¥–ç±»å‹æ˜¯æˆ‘åœ¨OCä¸­æ²¡æœ‰æ¥è§¦çš„ç±»å‹ï¼Œæˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡å­¦ä¹ ç¬”è®°ä¸­å®Œæ•´çš„å­¦ä¹ å’Œåˆ†äº«åœ¨å®é™…ä½¿ç”¨ä¸­çš„ä¸€äº›ä¾‹å­ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://wiki.jikexueyuan.com/project/swift/" target="_blank" rel="external">The Swift Programming Language ä¸­æ–‡ç‰ˆ</a></p>
<p><a href="https://developer.apple.com/library/prerelease/content/documentation/Swift/Conceptual/Swift_Programming_Language/index.html#//apple_ref/doc/uid/TP40014097-CH3-ID0" target="_blank" rel="external">The Swift Programming Language (Swift 3)</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&amp;nbsp;  Apple å‘å¸ƒäº†Swift 3.0,ç‰ˆæœ¬è¯­æ³•åº”è¯¥ç›¸å¯¹ç¨³å®šäº†ï¼Œå¼€å§‹æ–°ä¸€è½®å­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;&amp;nbsp;  Swiftå­¦ä¹ ä¸»è¦ä»The Basicså¼€å§‹å­¦ä¹ ï¼Œè™½ç„¶ä¹‹å‰å·²ç»å­¦ä¹ è¿‡Objective-C,ä½†è¿˜æ˜¯è¿‡ä¸€éåŸºæœ¬çš„è¯­æ³•ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Swift&lt;/code&gt; provides its own versions of all fundamental &lt;code&gt;C&lt;/code&gt; and &lt;code&gt;Objective-C&lt;/code&gt; types, including &lt;code&gt;Int&lt;/code&gt; for integers, Doubleand &lt;code&gt;Float&lt;/code&gt; for floating-point values, &lt;code&gt;Bool&lt;/code&gt; for Boolean values, and &lt;code&gt;String&lt;/code&gt; for textual data. &lt;code&gt;Swift&lt;/code&gt; also provides powerful versions of the three primary collection types, &lt;code&gt;Array&lt;/code&gt;, &lt;code&gt;Set&lt;/code&gt;, and &lt;code&gt;Dictionary&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Learn Swift" scheme="https://github.com/VeinGuo/tags/Learn-Swift/"/>
    
  </entry>
  
  <entry>
    <title>åˆå…¥æ±Ÿæ¹–</title>
    <link href="https://github.com/VeinGuo/2016/07/10/first-bolg/"/>
    <id>https://github.com/VeinGuo/2016/07/10/first-bolg/</id>
    <published>2016-07-10T06:33:05.000Z</published>
    <updated>2017-06-20T07:56:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä½¿ç”¨åšå®¢"><a href="#ä½¿ç”¨åšå®¢" class="headerlink" title="ä½¿ç”¨åšå®¢"></a>ä½¿ç”¨åšå®¢</h3><p>ä½¿ç”¨åšå®¢æ˜¯ä¸ºäº†æŠŠå¼€å‘æ—¶è¸©åˆ°çš„å‘ã€å­¦ä¹ å¿ƒå¾—è®°å½•ä¸‹æ¥ã€‚</p>
<h3 id="è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´"><a href="#è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´" class="headerlink" title="è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´"></a>è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;About&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;Name&quot;: &quot;VeinGuo&quot;,</div><div class="line">            &quot;Email&quot;: &quot;gwrit@foxmail.com&quot;,</div><div class="line">            &quot;Hobby&quot;: &quot;Basketball , coding&quot;,</div><div class="line">            &quot;From&quot;: &quot;XiaMen,China&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä½¿ç”¨åšå®¢&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨åšå®¢&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨åšå®¢&quot;&gt;&lt;/a&gt;ä½¿ç”¨åšå®¢&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨åšå®¢æ˜¯ä¸ºäº†æŠŠå¼€å‘æ—¶è¸©åˆ°çš„å‘ã€å­¦ä¹ å¿ƒå¾—è®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´&quot;&gt;&lt;a href=&quot;#è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´&quot; class=&quot;headerlink&quot; title=&quot;è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´&quot;&gt;&lt;/a&gt;è®°å½•ä¸‹æˆé•¿çš„ç‚¹ç‚¹æ»´æ»´&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;quot;About&amp;quot;: [&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;quot;Name&amp;quot;: &amp;quot;VeinGuo&amp;quot;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;quot;Email&amp;quot;: &amp;quot;gwrit@foxmail.com&amp;quot;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;quot;Hobby&amp;quot;: &amp;quot;Basketball , coding&amp;quot;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;quot;From&amp;quot;: &amp;quot;XiaMen,China&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="åˆå…¥æ±Ÿæ¹–" scheme="https://github.com/VeinGuo/tags/%E5%88%9D%E5%85%A5%E6%B1%9F%E6%B9%96/"/>
    
  </entry>
  
</feed>
